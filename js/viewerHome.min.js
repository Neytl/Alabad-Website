function getPageName(){return window.location.pathname.endsWith(".html")?window.location.pathname.substring(1,window.location.pathname.length-5):window.location.pathname.substring(1,window.location.pathname.length)}function usingSpanish(){return language=="Spanish"}function get(n){return document.getElementById(n)}function getAll(n){return Array.from(document.querySelectorAll(n))}function removeChildren(n){while(n.firstChild)n.removeChild(n.firstChild)}function make(n){return document.createElement(n)}function buildIcon(n,t){let i=make("img");return i.src="imgs/icons/"+n,!t||i.classList.add(t),i}function build(n){let t=document.createElement(n.type);return n.class?t.classList.add(n.class):!n.classes||n.classes.forEach(n=>t.classList.add(n)),!n.id||(t.id=n.id),!n.title||(t.title=n.title),!n.innerHTML||(t.innerHTML=n.innerHTML),n.child?t.appendChild(n.child):!n.children||n.children.forEach(n=>t.appendChild(n)),!n.src||(t.src=n.src),!n.onclick||t.addEventListener("click",n.onclick),t}function deleteElement(n){!n||n.remove()}function clickedOn(n,t){return n.target.closest("#"+t)===get(t)}function onDomLoad(){(pageName=="charts"||pageName=="chart")&&(language="English");!localStorage.getItem("lightMode")||(document.documentElement.classList.add("lightMode"),get("darkModeIcon").src="imgs/icons/light-mode.png")}function setupSharedEvents(){fetch(dbUrl+"/start");getAll(".menuSectionTitle").forEach(n=>{n.classList.contains("noToggle")||n.addEventListener("click",function(){this.parentElement.classList.toggle("closed")})});get("returnToCenterCover").addEventListener("click",function(){currentMenu=null;seamless.scrollIntoView(get("contentContainer"),{behavior:"smooth",block:"start",inline:"start"},{duration:350});get("contentContainer").classList.remove("dark")});get("darkModeButton").addEventListener("click",function(){document.documentElement.classList.toggle("lightMode")?(localStorage.setItem("lightMode",!0),get("darkModeIcon").src="imgs/icons/light-mode.png"):(localStorage.removeItem("lightMode"),get("darkModeIcon").src="imgs/icons/dark-mode.png")});setupSearchPopup();let i=function(){get("contentContainer").scrollIntoView({inline:"start",block:"start"});get("contentContainer").classList.remove("dark")};window.addEventListener("resize",i);let n=!1;get("languageMenuContainer").addEventListener("click",t=>{clickedOn(t,"languageOptions")||(n=!n,get("languageMenuContainer").classList.toggle("open"))});document.addEventListener("click",t=>{!n||clickedOn(t,"languageMenuContainer")||clickedOn(t,"languageOptions")||(n=!1,get("languageMenuContainer").classList.remove("open"))});let t=!1;get("accountMenuContainer").addEventListener("click",n=>{clickedOn(n,"accountMenu")||(t=!t,get("accountMenuContainer").classList.toggle("open"))});document.addEventListener("click",n=>{!t||clickedOn(n,"accountMenuContainer")||clickedOn(n,"accountMenu")||(t=!1,get("accountMenuContainer").classList.remove("open"))});getAll("img").forEach(n=>n.draggable=!1)}function setupSearchPopup(){let n=get("searchInput"),t=function(){n.value="";get("clearSearchButton").classList.add("hidden");get("noResults").classList.add("hidden");get("popupLoadingResults").classList.add("hidden");removeChildren(get("searchResults"))};get("searchButton").addEventListener("click",function(){get("searchPopup").classList.remove("hidden");n.focus()});get("cancelSearchButton").addEventListener("click",function(){get("searchPopup").classList.add("hidden");t()});get("searchInput").addEventListener("keydown",function(n){switch(n.key){case"Escape":get("searchPopup").classList.add("hidden");t()}});get("clearSearchButton").addEventListener("click",function(){t();n.focus()});get("searchInputButton").addEventListener("click",function(){n.focus()});n.addEventListener("keydown",function(t){switch(t.key){case"Enter":n.blur();return}});n.addEventListener("input",updateSearchResults)}function noDBConnection(n){return n.status===503}function updateSearchResults(){let t=get("searchInput").value,n=get("searchResults");if(get("noResults").classList.add("hidden"),t.length>0)get("clearSearchButton").classList.remove("hidden");else{get("clearSearchButton").classList.add("hidden");removeChildren(n);return}n.children.length==0&&get("popupLoadingResults").classList.remove("hidden");fetch(dbUrl+"/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchText:t,language:showUnfinishedSongs?null:language,showUnfinishedSongs:showUnfinishedSongs,token:localStorage.getItem("token")})}).then(n=>n.json()).then(t=>{if(removeChildren(n),get("popupLoadingResults").classList.add("hidden"),noDBConnection(t)){get("noResults").classList.remove("hidden");return}if(t.length===0){get("noResults").classList.remove("hidden");return}t.forEach(function(t){let i="-";!t.artist||(i=t.artist,i.startsWith("[")||(i=usingSpanish()?"por "+i:"by "+i));t.isChartCompleted||(i+=usingSpanish()?" *INACABADO*":" *UNFINISHED*");let r=build({type:"div","class":"searchResult",children:[build({type:"div",children:[buildIcon("note.png"),build({type:"span",innerHTML:t.songName})]}),build({type:"span",innerHTML:i})]});r.addEventListener("click",function(){window.location.href=(usingSpanish()?"tabla?song_id=":"chart?song_id=")+t.id});n.appendChild(r)})})}function loadLoggedInFeatures(){get("loggedInUser").innerHTML=localStorage.getItem("loggedInUser");get("openLoginPopupButton").classList.add("hidden");get("accountMenuContainer").classList.remove("hidden")}function unloadLoggedInFeatures(){get("accountMenuContainer").classList.add("hidden");get("openLoginPopupButton").classList.remove("hidden");showUnfinishedSongs=!1}function setupLoginEvents(){get("openLoginPopupButton").addEventListener("click",openLoginPopup);get("logOutButton").addEventListener("click",runLogout);get("closeLoginPopupButton").addEventListener("click",closeLoginPopup);get("loginPopupContainer").addEventListener("click",function(n){n.target.closest("#loginPopup")!=get("loginPopup")&&closeLoginPopup()});get("loginUsername").addEventListener("focus",clearLoginMessage);get("loginPassword").addEventListener("focus",clearLoginMessage);get("loginUsername").addEventListener("keypress",n=>{n.key=="Enter"&&(get("loginUsername").blur(),get("loginButton").click())});get("loginPassword").addEventListener("keypress",n=>{n.key=="Enter"&&(get("loginPassword").blur(),get("loginButton").click())});get("loginButton").addEventListener("click",function(){if(!get("loginUsername").value){setLoginMessage("Enter your username");return}if(!get("loginPassword").value){setLoginMessage("Enter your password");return}runLogin()});let n=localStorage.getItem("timeLoggedIn");n?(n=parseInt(n),(Date.now()-n)/36e5>5&&runLogout()):runLogout()}function setLoginMessage(n){get("loginMessage").innerHTML=n;get("loginMessage").classList.add("active")}function clearLoginMessage(){get("loginMessage").classList.remove("active")}function clearLoginFields(){get("loginUsername").value="";get("loginPassword").value=""}function runLogin(){localStorage.setItem("connection","loggingIn");fetch(loginURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Username:get("loginUsername").value,Password:get("loginPassword").value})}).then(n=>{n.ok?onValidLogin(n):n.status===401?(localStorage.removeItem("token"),localStorage.setItem("connection","loggedOut"),setLoginMessage("Username or password is incorrect")):n.status===503&&(get("loginPassword").value="",localStorage.setItem("connection","noConnection"),setLoginMessage("Login failed: Could not connect to the database"))})}async function onValidLogin(n){let i=await n.json(),t=JSON.stringify(i);localStorage.setItem("token",t.substring(1,t.length-1));localStorage.setItem("timeLoggedIn",Date.now());localStorage.setItem("loggedInUser",get("loginUsername").value);get("loginPassword").value="";onConnectionEstablished()}function openLoginPopup(){get("loginPopupContainer").classList.remove("hidden")}function closeLoginPopup(){get("loginPopupContainer").classList.add("hidden");clearLoginFields();clearLoginMessage()}function testDatabaseEditorConnection(){let n=localStorage.getItem("connection");if(n!="noConnection"){if(n=="loggedIn"){let n=localStorage.getItem("timeLoggedIn");if(!n){runLogout();return}if(n=parseInt(n),(Date.now()-n)/36e5>5){runLogout();return}loadLoggedInFeatures();return}let t=localStorage.getItem("token");if(!t){localStorage.setItem("connection","loggedOut");return}fetch(updateCabinetURL+"/testConnection",{headers:{Authorization:"Bearer "+t}}).then(n=>{if(n.ok){onConnectionEstablished();return}n.status===401?(localStorage.removeItem("token"),localStorage.setItem("connection","loggedOut")):n.status===503&&(localStorage.setItem("connection","noConnection"),setLoginMessage("Login failed: Could not connect to the database"))})}}function onConnectionEstablished(){localStorage.setItem("connection","loggedIn");closeLoginPopup();loadLoggedInFeatures();showUnfinishedSongs||get("showUnfinishedSongsToggle").click()}function runLogout(){unloadLoggedInFeatures();localStorage.setItem("connection","loggedOut");localStorage.removeItem("showUnfinishedSongs");localStorage.removeItem("token");localStorage.removeItem("timeLoggedIn");localStorage.removeItem("loggedInUser")}function isLoggedIn(){return localStorage.getItem("connection")=="loggedIn"}var seamless=function(n){"use strict";function t(n,t){var i="function"==typeof Symbol&&n[Symbol.iterator],r,f,u,e;if(!i)return n;u=i.call(n);e=[];try{for(;(void 0===t||t-->0)&&!(r=u.next()).done;)e.push(r.value)}catch(n){f={error:n}}finally{try{r&&!r.done&&(i=u.return)&&i.call(u)}finally{if(f)throw f.error;}}return e}function bt(n,t){this.scrollLeft=n;this.scrollTop=t}function v(){var n,t;return v=t=(null===(n=window.performance)||void 0===n?void 0:n.now)?function(){return window.performance.now()}:function(){return window.Date.now()},t()}function si(n){w(this,{block:null==n||n?"start":"end",inline:"nearest"})}var u=function(){return u=Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},u.apply(this,arguments)},k=function(n){return void 0===n||"auto"===n||"instant"===n||"smooth"===n},d=function(n,t,i){return void 0===i&&(i="cannot convert to dictionary."),"Failed to execute '".concat(n,"' on '").concat(t,"': ").concat(i)},g=function(n,t,i){return d(n,t,"The provided value '".concat(i,"' is not a valid enum value of type ScrollBehavior."))},r=function(n,t,i){var r,u="__SEAMLESS.BACKUP$".concat(t);return n[u]||!n[t]||(null===(r=n[t])||void 0===r?void 0:r.__isPolyfill)||(n[u]=n[t]),n[u]||i},nt=function(n){var t=typeof n;return null!==n&&("object"===t||"function"===t)},l=function(n){return"scrollBehavior"in window.document.documentElement.style&&!0!==(null==n?void 0:n.forcePolyfill)},tt=function(n){Object.defineProperty(n,"__isPolyfill",{value:!0})},f=function(n,t){tt(t);[HTMLElement.prototype,SVGElement.prototype,Element.prototype].forEach(function(i){r(i,n);i[n]=t})},a=function(n){return n.ownerDocument.scrollingElement||n.ownerDocument.documentElement},kt=function(n){return.5*(1-Math.cos(Math.PI*n))},it=function(n){var t=(v()-n.timeStamp)/(n.duration||500);if(t>1)return n.method(n.targetX,n.targetY),void n.callback();var i=(n.timingFunc||kt)(t),r=n.startX+(n.targetX-n.startX)*i,u=n.startY+(n.targetY-n.startY)*i;n.method(r,u);n.rafId=window.requestAnimationFrame(function(){it(n)})},e=function(n){return isFinite(n)?Number(n):0},dt=function(n,t,i){var o,s,p,y;if(function(n){var t;return null!==(t=n.isConnected)&&void 0!==t?t:!(n.ownerDocument&&1&n.ownerDocument.compareDocumentPosition(n))}(n)){var h=n.scrollLeft,c=n.scrollTop,l=e(null!==(o=t.left)&&void 0!==o?o:h),a=e(null!==(s=t.top)&&void 0!==s?s:c);if(l!==h||a!==c)if(p=r(HTMLElement.prototype,"scroll",bt),y=r(Object.getPrototypeOf(n),"scroll",p).bind(n),"smooth"===t.behavior){var w=function(){window.removeEventListener("wheel",f);window.removeEventListener("touchmove",f)},b=u(u({},i),{timeStamp:v(),startX:h,startY:c,targetX:l,targetY:a,rafId:0,method:y,callback:function(){w();var t=9===n.nodeType;n.dispatchEvent(function(n){if("function"==typeof Event)return new Event("scrollend",{bubbles:n,cancelable:!1});var t=document.createEvent("Event");return t.initEvent("scrollend",n,!1),t}(t))}}),f=function(){window.cancelAnimationFrame(b.rafId);w()};window.addEventListener("wheel",f,{passive:!0,once:!0});window.addEventListener("touchmove",f,{passive:!0,once:!0});it(b)}else y(l,a)}},y=function(n){return function(i,r,u){var s,h=t((s=i).window===s?[a(i.document.documentElement),"Window"]:[i,"Element"],2),o=h[0],c=h[1],f=null!=r?r:{};if(!nt(f))throw new TypeError(d(n,c));if(!k(f.behavior))throw new TypeError(g(n,c,f.behavior));"scrollBy"===n&&(f.left=e(f.left)+o.scrollLeft,f.top=e(f.top)+o.scrollTop);dt(o,f,u)}},o=y("scroll"),s=y("scrollTo"),h=y("scrollBy"),rt=o,gt=s,ni=h,ti=o,ii=s,ri=h,ut=function(n){switch(n){case"horizontal-tb":case"lr":case"lr-tb":case"rl":case"rl-tb":return 0;case"vertical-rl":case"tb":case"tb-rl":return 1;case"vertical-lr":case"tb-lr":return 2;case"sideways-rl":return 3;case"sideways-lr":return 4}return 0},ft=function(n,i,r,u){var e,f=0;switch(i||(f^=2),n){case 0:f=f>>1|(1&f)<<1;r=(e=t([u,r],2))[0];u=e[1];break;case 1:case 3:f^=1;break;case 4:f^=2}return[f,r,u]},ui=function(n){return 1==(1&ft(ut(n.writingMode),"rtl"!==n.direction,void 0,void 0)[0])},et=function(n,t,i,r,u,f,e){return 0!==n?n:u<t&&f>i||u>t&&f<i?null:u<=t&&e<=r||f>=i&&e>=r?2:f>i&&e<r||u<t&&e>r?3:null},ot=function(n){return"visible"!==n&&"clip"!==n},fi=function(n,t){return(n.clientHeight<n.scrollHeight||n.clientWidth<n.scrollWidth)&&(ot(t.overflowY)||ot(t.overflowX)||n===a(n))},st=function(n){var t=n.parentNode,i=n.parentElement;if(null===i&&null!==t){if(11===t.nodeType)return t.host;if(9===t.nodeType)return function(n){var t;try{return(null===(t=n.ownerDocument.defaultView)||void 0===t?void 0:t.frameElement)||null}catch(n){return null}}(n)}return i},p=function(n,t,i){return n<t?t:n>i?i:n},c=function(n,t,i){switch(n){case 1:return(t+i)/2;case 3:return i;case 2:case 0:return t}},ei=function(n,i){var f,e,o,r=null===(f=n.ownerDocument.defaultView)||void 0===f?void 0:f.visualViewport,u=t(n===a(n)?[0,0,null!==(e=null==r?void 0:r.width)&&void 0!==e?e:n.clientWidth,null!==(o=null==r?void 0:r.height)&&void 0!==o?o:n.clientHeight]:[i.left,i.top,n.clientWidth,n.clientHeight],4),c=u[0],l=u[1],v=u[2],y=u[3],s=c+n.clientLeft,h=l+n.clientTop;return[h,s+v,h+y,s]},oi=function(n,i){var v=[],y=n.ownerDocument,w=y.defaultView,l;if(!w)return v;for(var s=window.getComputedStyle(n),vt="rtl"!==s.direction,ot=t(function(n,i,r){var u=t(ft(i,r,n.block||"start",n.inline||"nearest"),3),f=u[0];return[u[1],u[2]].map(function(n,t){switch(n){case"center":return 1;case"nearest":return 0;default:return"start"===n==!(f>>t&1)?2:3}})}(i,ut(s.writingMode||s.getPropertyValue("-webkit-writing-mode")||s.getPropertyValue("-ms-writing-mode")),vt),2),yt=ot[0],pt=ot[1],h=t(function(n,t,i){var u,f=t.top,e=t.right,o=t.bottom,s=t.left,h=(u=n.ownerDocument,["scroll-margin","scroll-snap-margin"].filter(function(n){return n in u.documentElement.style})[0]),r;return h?(r=function(n){var t=i.getPropertyValue("".concat(h,"-").concat(n));return parseInt(t,10)||0},[f-r("top"),e+r("right"),o+r("bottom"),s-r("left")]):[f,e,o,s]}(n,n.getBoundingClientRect(),s),4),u=h[0],f=h[1],e=h[2],o=h[3],r=st(n);null!==r;r=st(r)){if(y!==r.ownerDocument){if(!(w=(y=r.ownerDocument).defaultView))break;var ht=r.getBoundingClientRect(),ct=ht.left,lt=ht.top;u+=lt;f+=ct;e+=lt;o+=ct}if(l=w.getComputedStyle(r),"fixed"===l.position)break;if(fi(r,l)){var wt=r.getBoundingClientRect(),a=t(ei(r,wt),4),b=a[0],k=a[1],d=a[2],g=a[3],nt=et(yt,g,k,r.clientWidth,o,f,f-o),tt=et(pt,b,d,r.clientHeight,u,e,e-u),at=null===nt?0:c(nt,o,f)-c(nt,g,k),bt=null===tt?0:c(tt,u,e)-c(tt,b,d),it=ui(l)?p(at,-r.scrollWidth+r.clientWidth-r.scrollLeft,-r.scrollLeft):p(at,-r.scrollLeft,r.scrollWidth-r.clientWidth-r.scrollLeft),rt=p(bt,-r.scrollTop,r.scrollHeight-r.clientHeight-r.scrollTop);v.push([r,{left:r.scrollLeft+it,top:r.scrollTop+rt,behavior:i.behavior}]);u=Math.max(u-rt,b);f=Math.min(f-it,k);e=Math.min(e-rt,d);o=Math.max(o-it,g)}}return v},ht=function(n,i,r){var u=i||{};if(!k(u.behavior))throw new TypeError(g("scrollIntoView","Element",u.behavior));oi(n,u).forEach(function(n){var i=t(n,2),u=i[0],f=i[1];rt(u,f,r)})},w=ht,i=function(n,t){return function(i){if(!l(i)){var r={scroll:o,scrollTo:s,scrollBy:h}[n];t(n,function(){var n=arguments;1!==arguments.length?r(this,{left:n[0],top:n[1]}):r(this,n[0],i)})}}},ct=i("scroll",f),lt=i("scrollTo",f),at=i("scrollBy",f),b=function(n,t){tt(t);r(window,n);window[n]=t},vt=i("scroll",b),yt=i("scrollTo",b),pt=i("scrollBy",b),wt=function(n){if(!l(n)){var t=r(window.HTMLElement.prototype,"scrollIntoView",si);f("scrollIntoView",function(){var i=arguments,r=i[0];1===i.length&&nt(r)?w(this,r,n):t.apply(this,i)})}};return n.elementScroll=rt,n.elementScrollBy=ni,n.elementScrollByPolyfill=at,n.elementScrollIntoView=w,n.elementScrollIntoViewPolyfill=wt,n.elementScrollPolyfill=ct,n.elementScrollTo=gt,n.elementScrollToPolyfill=lt,n.polyfill=function(n){l(n)||(ct(n),lt(n),at(n),wt(n),vt(n),yt(n),pt(n))},n.scroll=o,n.scrollBy=h,n.scrollIntoView=ht,n.scrollTo=s,n.windowScroll=ti,n.windowScrollBy=ri,n.windowScrollByPolyfill=pt,n.windowScrollPolyfill=vt,n.windowScrollTo=ii,n.windowScrollToPolyfill=yt,n}({}),language;"object"==typeof module&&(module.exports=seamless);var prefix=window.location.origin.includes("local")?"":"https://thecabinet20230725181154.azurewebsites.net",dbUrl=prefix+"/api/Songs",pageName=getPageName(),showUnfinishedSongs=localStorage.getItem("showUnfinishedSongs")=="true",currentMenu;language="Spanish";document.addEventListener("DOMContentLoaded",function(){onDomLoad()});window.addEventListener("load",function(){setupSharedEvents();get("settingsMenuButton").addEventListener("click",function(){currentMenu="Settings";get("settingsMenu").classList.remove("hidden");get("contentContainer").scrollIntoView({inline:"start",block:"start"});get("contentContainer").classList.add("dark");seamless.scrollIntoView(get("settingsMenu"),{behavior:"smooth",block:"start",inline:"start"},{duration:350})});get("fakeSearchBar").addEventListener("click",function(){get("searchPopup").classList.remove("hidden");get("searchInput").focus()});get("logoContainer").addEventListener("click",function(){location.reload()});let n=JSON.parse(localStorage.getItem("setListData"));n&&(n.songs.forEach(t=>{let i=t.artist;i?i.startsWith("[")&&(i=i.slice(1,-1)):i=usingSpanish()?"No Artista":"No Artist";i="("+i+")";t.isChartCompleted||(i+="*");let r=build({type:"a","class":"setListSong",children:[buildIcon("note.png"),build({type:"div","class":"setListSongName",children:[build({type:"span",innerHTML:t.songName}),build({type:"span","class":"setListArtist",innerHTML:i})]})]});r.href=(usingSpanish()?"tabla":"chart")+"?set_list="+(n.setId?n.setId:"local")+"&song_id="+t.id;get("setListSongs").appendChild(r)}),!n.setListName||(get("setListName").innerHTML=n.setListName,!n.setId||(get("setListName").href=(usingSpanish()?"tabla":"chart")+"?set_list="+n.setId)),get("setListSongsSection").classList.remove("hidden"))});window.addEventListener("pageshow",n=>{n.persisted&&!get("searchPopup").classList.contains("hidden")&&get("cancelSearchButton").click()});var prefix=window.location.origin.includes("local")?"":"https://thecabinet20230725181154.azurewebsites.net",updateCabinetURL=prefix+"/api/UpdateCabinet",loginURL=prefix+"/api/Login";document.addEventListener("DOMContentLoaded",function(){testDatabaseEditorConnection()});window.addEventListener("load",function(){setupLoginEvents();get("showUnfinishedSongsCheckBox").checked=showUnfinishedSongs;get("showUnfinishedSongsToggle").addEventListener("click",function(){showUnfinishedSongs=!showUnfinishedSongs;limitToCurrentLanguage=!showUnfinishedSongs;get("showUnfinishedSongsCheckBox").checked=showUnfinishedSongs;localStorage.setItem("showUnfinishedSongs",showUnfinishedSongs)})});