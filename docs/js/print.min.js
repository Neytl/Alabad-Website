function getPageName(){return window.location.pathname.endsWith(".html")?window.location.pathname.substring(1,window.location.pathname.length-5):window.location.pathname.substring(1,window.location.pathname.length)}function usingSpanish(){return language=="Spanish"}function get(n){return document.getElementById(n)}function getAll(n){return Array.from(document.querySelectorAll(n))}function getFirst(n){return document.querySelector(n)}function getAllClass(n){return Array.from(document.getElementsByClassName(n))}function removeChildren(n){while(n.firstChild)n.removeChild(n.firstChild)}function forEachClassElement(n,t){getAllClass(n).forEach(n=>{t(n)})}function forEachElement(n,t){Array.from(document.querySelectorAll(n)).forEach(function(n){t(n)})}function clickedOn(n,t){return n.target.closest("#"+t)!=null}function clickedOnClass(n,t){return!!n.target.closest("."+t)}function setUpChoiceGroup(n,t){let i=Array.from(document.querySelectorAll(n));i.forEach(function(n){n.addEventListener("click",function(){i.forEach(function(n){n.classList.remove("chosen")});this.classList.add("chosen");t(n)})})}function addMiddleClickEvent(n,t){n.addEventListener("mousedown",n=>{n.which===2&&(n.preventDefault(),t(n))})}function openInNewTab(n){let t=make("a");t.href=n;t.target="_blank";t.click()}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}function make(n){return document.createElement(n)}function build(n){let t=document.createElement(n.type);return n.class?t.classList.add(n.class):!n.classes||n.classes.forEach(n=>t.classList.add(n)),!n.id||(t.id=n.id),!n.title||(t.title=n.title),!n.innerHTML||(t.innerHTML=n.innerHTML),n.child?t.appendChild(n.child):!n.children||n.children.forEach(n=>t.appendChild(n)),!n.onclick||t.addEventListener("click",n.onclick),t}function buildTextInput(n){n.type="input";let t=build(n);return t.type="text",t.classList.add("hoverInput"),!n.value||(t.value=n.value),n.noEvents||t.addEventListener("keydown",i=>{switch(i.key){case"Escape":if(!!n.onEscape)n.onEscape(t);t.blur();return;case"Enter":if(!!n.onEnter)n.onEnter(t);t.blur();return}}),t}function buildImage(n){n.type="img";let t=build(n);return t.src="imgs/icons/"+n.src,t.alt=n.alt?n.alt:n.src.split(".")[0],t}function buildDropdownOption(n,t,i){return build({type:"div","class":"dropdownOption",onclick:i,children:[buildImage({src:n}),build({type:"span",innerHTML:t})]})}function buildDropdown(n,t,i){let r=build({type:"div","class":"dropdown",children:t}),u=function(){document.body.contains(r)&&document.body.removeChild(r)};r.addEventListener("mouseleave",u);r.addEventListener("click",u);document.addEventListener("scroll",function f(n){n.currentTarget.removeEventListener(n.type,f);u()});i?r.style.left=n.clientX+window.pageXOffset-10+"px":r.style.right=document.documentElement.clientWidth-window.pageXOffset-n.clientX-10+"px";r.style.top=n.clientY+window.pageYOffset-10+"px";translateNodeToCurrentLanguage(r);document.body.appendChild(r)}function buildSongLink(n,t,i,r){let u=make("div");u.title=r;u.classList.add("songLink");let f=make("img");return f.src="imgs/icons/"+n,f.alt=t,u.appendChild(f),u.appendChild(i),u}function noDBConnection(n){return n.status===503}function search(){sessionStorage.setItem("search",get("searchInput").value);handleSearchRequest()}function promptToSongs(n){sessionStorage.setItem("prompt",n);window.location.href="databaseSongs.html"}function clearSearchData(){sessionStorage.removeItem("search");clearRefineSearchData()}function clearRefineSearchData(){sessionStorage.removeItem("resultTypeSearch");sessionStorage.removeItem("languageSearch");sessionStorage.removeItem("styles");sessionStorage.removeItem("lyricsSearch")}function loadSearchEvents(n){get("searchButton").addEventListener("click",function(){if(onHomePage()&&numResults==0){get("searchInput").focus();return}search()});searchInput.addEventListener("focus",()=>{searchInput.select(),numResults>0&&get("searchContainer").classList.add("hasResults"),get("searchBar").classList.add("focused"),get("searchResults").classList.remove("hidden")});searchInput.addEventListener("blur",function(){get("searchBar").classList.remove("focused");get("searchContainer").classList.remove("hasResults");get("searchResults").classList.add("hidden")});searchInput.addEventListener("keydown",function(n){let t=1;switch(n.key){case"Escape":this.value="";return;case"Enter":search();this.blur();return;case"ArrowUp":t=-1;case"ArrowDown":if(numResults===0)return;currentHovering>=0&&getDropdownResult(currentHovering).classList.remove("hovering");currentHovering===-1&&t===-1&&(currentHovering=0);currentHovering+=t;currentHovering>=numResults&&(currentHovering-=numResults);currentHovering<0&&(currentHovering+=numResults);let n=getDropdownResult(currentHovering);n.classList.add("hovering");this.value=n.name;return}});n?searchInput.addEventListener("input",updateSearchResults):searchInput.addEventListener("input",updateSearchResultsForDBPage)}function getDropdownResult(n){return get("searchResults").childNodes[n]}function updateSearchResults(n){let i=get("searchInput").value,t=get("searchResults");if(i.length===0){removeChildren(t);get("searchContainer").classList.remove("hasResults");numResults=0;loadingInitialSearchResults=!1;return}if(numResults==0&&!loadingInitialSearchResults){loadingInitialSearchResults=!0;let n=make("div");n.classList.add("searchResult");let i=make("div");i.classList.add("centerItems");n.appendChild(i);let r=make("img");r.src="imgs/icons/note.png";i.appendChild(r);let u=make("div");n.appendChild(u);u.innerHTML=usingSpanish()?"Buscando...":"Searching...";removeChildren(t);t.appendChild(n);get("searchContainer").classList.add("hasResults")}fetch(dbUrl+"/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchText:i,language:language,token:localStorage.getItem("token")})}).then(n=>n.json()).then(r=>{if(removeChildren(t),currentHovering=-1,loadingInitialSearchResults=!1,noDBConnection(r)){let n=make("div");n.classList.add("searchResult");let i=make("div");i.classList.add("centerItems");n.appendChild(i);let r=make("img");r.src="imgs/icons/noResults.png";i.appendChild(r);let u=make("div");n.appendChild(u);u.innerHTML="Unable to connect";t.appendChild(n);get("searchContainer").classList.add("hasResults");return}if(numResults=r.length,numResults===0){showNoResults();return}t.classList.contains("hidden")||get("searchContainer").classList.add("hasResults");r.forEach(function(n){let r=n.songName,u=r.toLowerCase().replaceAll("�","n").replaceAll("�","a").replaceAll("�","e").replaceAll("�","i").replaceAll("�","o").replaceAll("�","u").replaceAll("�","u");u=u.replace(new RegExp("("+i+")","ig"),"<strong-$1>/strong-");for(let n=0;n<u.length;n++)switch(u.charAt(n)){case"<":r=[r.slice(0,n),"<strong>",r.slice(n)].join("");n+=7;break;case">":r=[r.slice(0,n),"<\/strong>",r.slice(n)].join("");n+=8}let f=build({type:"div","class":"searchResult",children:[build({type:"div","class":"centerItems",child:buildIcon("note.png")}),build({type:"div",innerHTML:r})]});f.addEventListener("mousedown",function(){window.location.href=(usingSpanish()?"imprimiendo":"printing")+"?song_id="+n.id});f.name=n.songName;f.dataset.songId=n.id;t.appendChild(f)});trySelectFirstOption(n)})}function updateSearchResultsForDBPage(n){let i=get("searchInput").value,t=get("searchResults");if(i.length===0){removeChildren(t);get("searchContainer").classList.remove("hasResults");numResults=0;loadingInitialSearchResults=!1;return}if(numResults==0&&!loadingInitialSearchResults){loadingInitialSearchResults=!0;let n=make("div");n.classList.add("searchResult");let i=make("div");i.classList.add("centerItems");n.appendChild(i);let r=make("img");r.src="imgs/icons/note.png";i.appendChild(r);let u=make("div");n.appendChild(u);u.innerHTML=usingSpanish()?"Buscando...":"Searching...";removeChildren(t);t.appendChild(n);get("searchContainer").classList.add("hasResults")}let r=!limitToCurrentLanguage?dbUrl+"/songNames/"+i:dbUrl+"/songNames/"+language+"/"+i;fetch(r).then(n=>n.json()).then(r=>{if(removeChildren(t),currentHovering=-1,loadingInitialSearchResults=!1,noDBConnection(r)){let n=make("div");n.classList.add("searchResult");let i=make("div");i.classList.add("centerItems");n.appendChild(i);let r=make("img");r.src="imgs/icons/noResults.png";i.appendChild(r);let u=make("div");n.appendChild(u);u.innerHTML="Unable to connect";t.appendChild(n);get("searchContainer").classList.add("hasResults");return}if(numResults=r.length,numResults===0){get("searchContainer").classList.remove("hasResults");return}t.classList.contains("hidden")||get("searchContainer").classList.add("hasResults");let u=0;r.forEach(function(n){let s=n.resultValue,f=make("div");f.name=s;f.classList.add("searchResult");let h=make("div");h.classList.add("centerItems");f.appendChild(h);let e=make("img");switch(n.resultType){case"song":e.src="imgs/icons/note.png";break;case"artist":e.src="imgs/icons/artist.png";break;case"playlist":e.src="imgs/icons/playlist.png"}h.appendChild(e);let c=make("div");f.appendChild(c);let r=s,o=r.toLowerCase().replaceAll("�","n").replaceAll("�","a").replaceAll("�","e").replaceAll("�","i").replaceAll("�","o").replaceAll("�","u").replaceAll("�","u");o=o.replace(new RegExp("("+i+")","ig"),"<strong-$1>/strong-");for(let n=0;n<o.length;n++)switch(o.charAt(n)){case"<":r=[r.slice(0,n),"<strong>",r.slice(n)].join("");n+=7;break;case">":r=[r.slice(0,n),"<\/strong>",r.slice(n)].join("");n+=8}c.innerHTML=r;f.addEventListener("mousedown",function(){currentHovering=this.dataset.resultNumber;get("searchInput").value=s;search()});f.dataset.resultNumber=u++;t.appendChild(f)});onHomePage()&&trySelectFirstOption(n)})}function onHomePage(){return pageName=="imprimir"||pageName=="print"}function trySelectFirstOption(n){if(currentHovering==-1){let t=get("searchInput"),i=getDropdownResult(0),r=i.name;if(currentHovering=0,i.classList.add("hovering"),n.inputType!="deleteContentBackward"&&r.toLowerCase().startsWith(t.value.toLowerCase())){let u=t.value.length;t.value=i.name;createSelection(t,u,i.name.length);return}}}function createSelection(n,t,i){if(n.createTextRange){var r=n.createTextRange();r.collapse(!0);r.moveStart("character",t);r.moveEnd("character",i);r.select()}else n.setSelectionRange?n.setSelectionRange(t,i):n.selectionStart&&(n.selectionStart=t,n.selectionEnd=i)}function showNoResults(){let i=get("searchResults"),n=make("div");n.classList.add("searchResult");let t=make("div");t.classList.add("centerItems");n.appendChild(t);let r=make("img");r.src="imgs/icons/noResults.png";t.appendChild(r);let u=make("div");u.innerHTML=usingSpanish()?"No Resultados":"No Results";n.appendChild(u);i.appendChild(n);i.classList.remove("hidden");get("searchContainer").classList.add("hasResults")}function loadNewSong(n){fetch(dbUrl+"/printableSong/"+n).then(n=>n.json()).then(n=>{n.title||n.title!="Not Found"||goHome();printData=n;let t=!!printData.fontSize;loadNewSavedPrintSettings();showChordData();loadInSongInfo();t?buildPages():fitToXColumns(2)})}function loadCurrentPrintData(){document.title=printData.songName;let n=!!printData.fontSize;loadNewSavedPrintSettings();showChordData();!printData.fontFamily||(get("fontStyleSelect").value=printData.fontFamily,get("chordChart").style.fontFamily=printData.fontFamily,get("editSongInput").style.fontFamily=printData.fontFamily);n?buildPages():fitToXColumns(2)}function loadNewSavedPrintSettings(){originalSongText=printData.text;originalKey=printData.key;originalUseFlats=printData.chordChartIsFlat;originalUseSolfege=printData.usingSolfege;printData.fontSize?setFontSize(parseFloat(printData.fontSize),!0):setFontSize(12,!0);setupNewPrintData(printData);printData.stretchedColumns?(get("columnsSelect").value="Stretched",get("columnsSelect").classList.add("wide")):(get("columnsSelect").value=printData.numColumns,get("columnsSelect").classList.remove("wide"));!printData.displayType||(get("displayType").value=printData.displayType,printData.displayType=="Lyrics"?hideChordOptions():activateChordOptions())}function buildPages(){if(savePrintData(),!setListPrintData||saveSetListPrintData(),removeChildren(chordChartElement),chordChartElement.classList.remove("sized"),setListPrintData)for(let n=0;n<setListPrintData.songs.length;n++)addSongToChordChart(setListPrintData.songs[n]);else addSongToChordChart(printData);chordChartElement.classList.add("sized");displayBuiltPages()}function addSongToChordChart(n){let e=n.shortenedChart;n.displayType=="Lyrics"?e=n.lyrics:n.displayType=="Complete"&&(e=n.html);n.numColumns||(n.numColumns=1);pageLinesGroups=e.split("<span class='lineGroup").map(n=>htmlToElement("<span class='lineGroup"+n));pageLinesGroups.shift();const o=1054;let t=[...pageLinesGroups],i=null,u=null,r=1,f=!1;for(t.length>0&&t[0].classList.contains("title")&&(i=build({type:"div",classes:["page","titlePage"],child:t.shift()}),setupNewPage(i,n),f=!0);t.length>0;){let e=build({type:"div","class":"pageColumn"});e.dataset.columnNumber=r;r==1?(u=build({type:"div","class":"pageColumns",child:e}),f?i.appendChild(u):(i=build({type:"div","class":"page",child:u}),setupNewPage(i,n)),chordChartElement.appendChild(i)):u.appendChild(e);r++;r>n.numColumns&&(r-=n.numColumns);let s=null;if(f)f=!1;else while(t.length>0&&t[0].innerText=="\n")t.shift();while(t.length>0&&i.offsetHeight<=o)s=t.shift(),e.appendChild(s);if(i.offsetHeight>o){if(e.removeChild(s),t.unshift(s),!e.innerHTML.includes(">\n<"))continue;while(!t[0].classList.contains("SS"))s=e.lastChild,e.removeChild(s),t.unshift(s)}}n.numColumns==2&&r==2&&u.classList.add("oneColumn")}function setupNewPage(n,t){n.style.fontSize=t.fontSize*1.5+"px";t.numColumns==2&&n.classList.add("twoColumns");!t.stretchedColumns||n.classList.add("stretchedColumns");!setListPrintData||(n.dataset.setListIndex=t.setListIndex,n.classList.add("setListIndex"+t.setListIndex),setListPrintData.selectedSongIndex==t.setListIndex&&n.classList.add("selectedSongPage"))}function htmlToElement(n){let t=document.createElement("template");return n=n.trim(),t.innerHTML=n,t.content.firstChild}function copyElement(n){return htmlToElement(n.outerHTML)}function displayBuiltPages(){let t=get("chordChart"),r=t.children,n=get("chordChartDisplay");removeChildren(n);n.classList=t.classList;n.style.fontFamily=t.style.fontFamily;let i=-1;initialResized=!1;for(let t=0;t<r.length;t++){let u=copyElement(r[t]),f=build({type:"div","class":"pageContainer",child:u});n.appendChild(f);i==-1&&(i=f.offsetWidth/u.offsetWidth-.001,new ResizeObserver(function(){if(!initialResized){initialResized=!0;return}this.unobserve(f);displayBuiltPages()}).observe(f));u.style.transform="scale("+i+")";!setListPrintData||f.addEventListener("click",function(){u.classList.contains("selectedSongPage")||(getAll(".selectedSongPage").forEach(n=>n.classList.remove("selectedSongPage")),getAll(".setListIndex"+u.dataset.setListIndex).forEach(n=>n.classList.add("selectedSongPage")),selectSetListSong(u.dataset.setListIndex),seamless.scrollIntoView(getFirst("#chordChartDisplay .selectedSongPage").parentElement,{behavior:"smooth"},{duration:350}))})}!setListPrintData||get("contentContainer").classList.contains("dark")||getFirst("#chordChartDisplay .selectedSongPage").parentElement.scrollIntoView()}function goHome(){window.location.href=usingSpanish()?"imprimir":"print"}function setupSlidingMenus(){get("songInfoButton").addEventListener("click",function(){seamless.scrollIntoView(get("infoMenu"),{behavior:"smooth",block:"start",inline:"start"},{duration:350});get("contentContainer").classList.add("dark")});get("chordsSettingsButton").addEventListener("click",function(){if(this.classList.contains("unavailable")){if(!printData.hasChords)return;printData.displayType="Chords";get("displayType").value="Chords";buildPages();activateChordOptions()}seamless.scrollIntoView(get("chordsMenu"),{behavior:"smooth",block:"start",inline:"end"},{duration:350});get("contentContainer").classList.add("dark")});getAll(".menuSectionTitle").forEach(n=>{n.classList.contains("noToggle")||n.addEventListener("click",function(){this.parentElement.classList.toggle("closed")})});get("returnToCenterCover").addEventListener("click",function(){seamless.scrollIntoView(get("contentContainer"),{behavior:"smooth",block:"start",inline:"start"},{duration:350});get("contentContainer").classList.remove("dark")});window.addEventListener("resize",snapCloseSideMenu);loadInSongInfo();get("moreVersionsButton").addEventListener("click",loadSongVersions);get("infoMenu").classList.remove("hidden");get("contentContainer").scrollIntoView({inline:"start",block:"start"});setupChordOptions()}function snapCloseSideMenu(){get("contentContainer").scrollIntoView({inline:"start",block:"start"});get("contentContainer").classList.remove("dark")}function loadInSongInfo(){printData&&(get("songDataName").innerHTML=printData.songName,setListPrintData||(document.title=printData.songName),printData.artist?(get("songDataArtist").innerHTML=printData.artist,get("songDataArtistContainer").classList.remove("hidden")):get("songDataArtistContainer").classList.add("hidden"),printData.songLink?(get("songDataYT").href=printData.songLink,get("songDataYTContainer").classList.remove("hidden")):get("songDataYTContainer").classList.add("hidden"),get("chordChartButton").href=(usingSpanish()?"tabla":"chart")+"?song_id="+printData.id)}function loadSongVersions(){loadedInVersions||(loadedInVersions=!0,printData.songVersions?displayVersions():fetch(dbUrl+"/versions/"+printData.id).then(n=>n.json()).then(n=>{printData.songVersions=n,savePrintData(),displayVersions()}))}function displayVersions(){if(printData.songVersions.length==0){get("versions").appendChild(build({type:"div",children:[buildIcon("close.png"),build({type:"span",innerHTML:usingSpanish()?"No Resultados":"No Versions Found"})],onclick:function(){get("moreVersionsButton").click()}}));return}removeChildren(get("versions"));printData.songVersions.forEach(n=>{get("versions").appendChild(build({type:"div",children:[buildIcon("note.png"),build({type:"div",children:[build({type:"span",innerHTML:printData.songName}),build({type:"span",innerHTML:!n.artist?usingSpanish()?" (No Artista)":" (No Artist)":" ("+n.artist+")"})]})],onclick:function(){snapCloseSideMenu();get("moreVersionsButton").click();loadedInVersions=!1;viewVersion(n.id)}}))})}function buildIcon(n){let t=make("img");return t.src="imgs/icons/"+n,t}function viewVersion(n){fetch(dbUrl+"/printableSong/"+n).then(n=>n.json()).then(n=>{if(n.title||n.title!="Not Found"){printData=n;loadNewSavedPrintSettings();let t=window.location.protocol+"//"+window.location.host+window.location.pathname+"?song_id="+printData.id;history.pushState(null,"",t);get("chordChart").style.fontFamily="Arial";get("editSongInput").style.fontFamily="Arial";get("fontStyleSelect").value="Arial";loadInSongInfo();buildPages()}})}function setupChordOptions(){get("originalKeyButton").addEventListener("click",function(){chordChartIsFlat=originalUseFlats;usingSolfege=originalUseSolfege;transposeTo(originalKey)});get("toSharpsButton").addEventListener("click",function(){setFlats(!1);postTextAndDisplay()});get("toFlatsButton").addEventListener("click",function(){setFlats(!0);postTextAndDisplay()});get("toLettersButton").addEventListener("click",function(){setSolfege(!1);postTextAndDisplay()});get("toSolfegeButton").addEventListener("click",function(){setSolfege(!0);postTextAndDisplay()});get("chordColor1Button").addEventListener("click",function(){this.classList.contains("selected")||(get("chordColor2Button").classList.remove("selected"),this.classList.add("selected"),setChordColor("chordColor1"))});get("chordColor2Button").addEventListener("click",function(){this.classList.contains("selected")||(get("chordColor1Button").classList.remove("selected"),this.classList.add("selected"),setChordColor("chordColor2"))})}function setChordColor(n){n&&n!="undefined"||(n="chordColor1");localStorage.setItem("chordColor",n);n==="chordColor1"?(document.body.classList.remove("chordColor2"),get("chordColor1Button").classList.add("selected"),get("chordColor2Button").classList.remove("selected")):(document.body.classList.add("chordColor2"),get("chordColor1Button").classList.remove("selected"),get("chordColor2Button").classList.add("selected"))}function buildKeyButtons(n,t,i,r){r!=originalKey?get("originalKeyButton").classList.remove("hidden"):get("originalKeyButton").classList.add("hidden");let u=[];u=t?n?keyOptions[0]:keyOptions[1]:n?keyOptions[2]:keyOptions[3];let f=get("keyButtons");removeChildren(f);u.forEach(function(n){i&&(n+="m");let t=make("div");t.innerHTML=n.replace("#","♯").replace("b","♭");n===r?t.classList.add("selectedKey"):t.addEventListener("click",function(){transposeTo(n)});f.appendChild(t)})}function showKeyChanges(n){if(!!n&&n.length>1){let t=n[0];for(let i=1;i<n.length;i++)t+=" ➔ "+n[i];get("keyChanges").innerHTML=t;get("keyChangesContaienr").classList.remove("hidden")}else get("keyChangesContaienr").classList.add("hidden")}function transposeTo(n){newKeyRequest=n;postTextAndDisplay()}function setFlats(n){n!==undefined&&(chordChartIsFlat=n,chordChartIsFlat?(get("toFlatsButton").classList.add("selected"),get("toSharpsButton").classList.remove("selected")):(get("toSharpsButton").classList.add("selected"),get("toFlatsButton").classList.remove("selected")))}function setSolfege(n){n!==undefined&&(usingSolfege=n,usingSolfege?(get("toSolfegeButton").classList.add("selected"),get("toLettersButton").classList.remove("selected")):(get("toLettersButton").classList.add("selected"),get("toSolfegeButton").classList.remove("selected")))}function setupPrintMeun(){get("displayType").addEventListener("change",function(){this.value==="Lyrics"?hideChordOptions():activateChordOptions();printData.displayType=this.value;buildPages()});get("fontSizeSelect").addEventListener("change",function(){setFontSize(parseFloat(this.value))});get("columnsSelect").addEventListener("change",function(){if(this.value=="Stretched"){if(printData.numColumns==1&&!!printData.stretchedColumns)return;printData.numColumns=1;printData.stretchedColumns=!0;get("columnsSelect").classList.add("wide")}else{let n=parseInt(this.value);if(printData.numColumns==n&&!printData.stretchedColumns)return;printData.numColumns=n;printData.stretchedColumns=!1;get("columnsSelect").classList.remove("wide")}buildPages()});get("fontStyleSelect").addEventListener("change",function(){setFontFamily(this.value)});setupPopups();get("editSongButton").addEventListener("click",function(){get("editSongInput").value=printData.text;openPopup("editSongPopup")});get("printButton").addEventListener("click",()=>{window.print(),snapCloseSideMenu()})}function setupPopups(){getAllClass("closePopup").forEach(n=>{n.addEventListener("click",closePopups)});get("submitEditButton").addEventListener("click",function(){originalSongText=get("editSongInput").value;postTextAndDisplay();closePopups()})}function closePopups(){get("popupContainer").classList.add("hidden");getAllClass("popup").forEach(n=>{n.classList.add("hidden")})}function openPopup(n){get(n).classList.remove("hidden");get("popupContainer").classList.remove("hidden")}function setFontSize(n,t){if(!isNaN(n)){if(n<MIN_FONT_SIZE){lastFontSize=MIN_FONT_SIZE;return}if(n>MAX_FONT_SIZE){lastFontSize=MAX_FONT_SIZE;return}n%.5>0&&(n%.5>=.25&&(n+=.5),n-=n%.5);printData.fontSize=n;get("fontSizeSelect").value=n;lastFontSize=n;t||buildPages()}}function setFontFamily(n){if(printData.fontFamily||(printData.fontFamily="Arial"),printData.fontFamily!=n){if(printData.fontFamily=="Arial")arialSongText=originalSongText;else if(n=="Arial"){get("chordChart").style.fontFamily="Arial";get("editSongInput").style.fontFamily="Arial";originalSongText=arialSongText;printData.fontFamily="Arial";postTextAndDisplay();return}let t={text:arialSongText,key:printData.key,chordChartIsFlat:chordChartIsFlat,usingSolfege:usingSolfege,language:printData.language,request:{oldFont:printData.fontFamily,newFont:n}};fetch(mainUrl+"/convertFont",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(n=>n.json()).then(t=>{get("chordChart").style.fontFamily=n,get("editSongInput").style.fontFamily=n,originalSongText=t.text,printData.fontFamily=n,showResponseChordChart(t)})}}function postTextAndDisplay(){let n={text:originalSongText,key:printData.key,chordChartIsFlat:chordChartIsFlat,usingSolfege:usingSolfege};!newKeyRequest||(n.key=newKeyRequest,newKeyRequest=undefined);!printData.language||(n.language=printData.language);fetch(mainUrl+"/parseText",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(n=>n.json()).then(n=>{showResponseChordChart(n)})}function showResponseChordChart(n){printData.text=n.text;printData.lyrics=n.lyrics;printData.html=n.html;printData.shortenedChart=n.shortenedChart;printData.title=n.title;printData.hasChords=n.hasChords;printData.usingSolfege=n.usingSolfege;printData.chordChartIsFlat=n.chordChartIsFlat;printData.key=n.key;printData.keyChanges=n.keyChanges;showChordData();buildPages()}function savePrintData(){localStorage.setItem("printData",JSON.stringify(printData))}function showChordData(){printData.hasChords?(getAll(".chordDisplayType").forEach(n=>n.classList.remove("hidden")),buildKeyButtons(printData.chordChartIsFlat,printData.usingSolfege,printData.isMinorKey,printData.key),showKeyChanges(printData.keyChanges),setFlats(printData.chordChartIsFlat),setSolfege(printData.usingSolfege)):noActiveChords()}function noActiveChords(){hideChordOptions();getAll(".chordDisplayType").forEach(n=>n.classList.add("hidden"));get("displayType").value="Lyrics";printData.displayType="Lyrics"}function hideChordOptions(){get("chordsSettingsButton").classList.add("unavailable")}function activateChordOptions(){get("chordsSettingsButton").classList.remove("unavailable")}function saveSetListPrintData(){localStorage.setItem("setListPrintData",JSON.stringify(setListPrintData))}function loadNewSetList(n){fetch(dbUrl+"/printableSetList/"+n).then(n=>n.json()).then(n=>{if(noDBConnection(n)||n.title==="Not Found"||n.title==="Bad Request"){goHome();return}setListPrintData={};setListPrintData.songs=n;setListPrintData.songs.map(setupNewPrintData);for(let n=0;n<setListPrintData.songs.length;n++)setListPrintData.songs[n].setListIndex=n;history.replaceState(null,"",window.location.href.split("?")[0]);selectSetListSong(0);buildPages()})}function selectSetListSong(n){setListPrintData.selectedSongIndex=n;printData=setListPrintData.songs[n];get("printSettingsHeader").innerHTML=printData.songName;loadNewSavedPrintSettings();showChordData();loadInSongInfo();document.title="Set List"}function setupNewPrintData(n){n.numColumns?((typeof n.numColumns=="string"||n.numColumns instanceof String)&&(n.numColumns=parseInt(n.numColumns)),n.numColumns==0?(n.numColumns=1,n.stretchedColumns=!0):n.stretchedColumns=!1):(n.numColumns=1,n.stretchedColumns=!1);n.displayType||(n.displayType=get("displayType").value)}function fitToXColumns(n){n==-1?(get("columnsSelect").value="Stretched",printData.numColumns=1,printData.stretchedColumns=!0):(get("columnsSelect").value=""+n,printData.numColumns=n,printData.stretchedColumns=!1);chordChartElement=get("chordChart");let t=MIN_FONT_SIZE;setFontSize(MIN_FONT_SIZE);const i=chordChartElement.childNodes.length;while(t<14){if(setFontSize(t+.5),chordChartElement.childNodes.length>i||n>0&&checkForLineWrap()){setFontSize(t);return}t+=.5}}function checkForLineWrap(){chordChartElement.classList.remove("sized");lineHeight=getFirst("#chordChart .lyrics").offsetHeight;var n=!1;return getAll("#chordChart .lyrics").forEach(t=>{if(t.offsetHeight>lineHeight*1.5){n=!0;return}}),chordChartElement.classList.add("sized"),n}var seamless=function(n){"use strict";function t(n,t){var i="function"==typeof Symbol&&n[Symbol.iterator],r,f,u,e;if(!i)return n;u=i.call(n);e=[];try{for(;(void 0===t||t-->0)&&!(r=u.next()).done;)e.push(r.value)}catch(n){f={error:n}}finally{try{r&&!r.done&&(i=u.return)&&i.call(u)}finally{if(f)throw f.error;}}return e}function bt(n,t){this.scrollLeft=n;this.scrollTop=t}function v(){var n,t;return v=t=(null===(n=window.performance)||void 0===n?void 0:n.now)?function(){return window.performance.now()}:function(){return window.Date.now()},t()}function si(n){w(this,{block:null==n||n?"start":"end",inline:"nearest"})}var u=function(){return u=Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},u.apply(this,arguments)},k=function(n){return void 0===n||"auto"===n||"instant"===n||"smooth"===n},d=function(n,t,i){return void 0===i&&(i="cannot convert to dictionary."),"Failed to execute '".concat(n,"' on '").concat(t,"': ").concat(i)},g=function(n,t,i){return d(n,t,"The provided value '".concat(i,"' is not a valid enum value of type ScrollBehavior."))},r=function(n,t,i){var r,u="__SEAMLESS.BACKUP$".concat(t);return n[u]||!n[t]||(null===(r=n[t])||void 0===r?void 0:r.__isPolyfill)||(n[u]=n[t]),n[u]||i},nt=function(n){var t=typeof n;return null!==n&&("object"===t||"function"===t)},l=function(n){return"scrollBehavior"in window.document.documentElement.style&&!0!==(null==n?void 0:n.forcePolyfill)},tt=function(n){Object.defineProperty(n,"__isPolyfill",{value:!0})},f=function(n,t){tt(t);[HTMLElement.prototype,SVGElement.prototype,Element.prototype].forEach(function(i){r(i,n);i[n]=t})},a=function(n){return n.ownerDocument.scrollingElement||n.ownerDocument.documentElement},kt=function(n){return.5*(1-Math.cos(Math.PI*n))},it=function(n){var t=(v()-n.timeStamp)/(n.duration||500);if(t>1)return n.method(n.targetX,n.targetY),void n.callback();var i=(n.timingFunc||kt)(t),r=n.startX+(n.targetX-n.startX)*i,u=n.startY+(n.targetY-n.startY)*i;n.method(r,u);n.rafId=window.requestAnimationFrame(function(){it(n)})},e=function(n){return isFinite(n)?Number(n):0},dt=function(n,t,i){var o,s,p,y;if(function(n){var t;return null!==(t=n.isConnected)&&void 0!==t?t:!(n.ownerDocument&&1&n.ownerDocument.compareDocumentPosition(n))}(n)){var h=n.scrollLeft,c=n.scrollTop,l=e(null!==(o=t.left)&&void 0!==o?o:h),a=e(null!==(s=t.top)&&void 0!==s?s:c);if(l!==h||a!==c)if(p=r(HTMLElement.prototype,"scroll",bt),y=r(Object.getPrototypeOf(n),"scroll",p).bind(n),"smooth"===t.behavior){var w=function(){window.removeEventListener("wheel",f);window.removeEventListener("touchmove",f)},b=u(u({},i),{timeStamp:v(),startX:h,startY:c,targetX:l,targetY:a,rafId:0,method:y,callback:function(){w();var t=9===n.nodeType;n.dispatchEvent(function(n){if("function"==typeof Event)return new Event("scrollend",{bubbles:n,cancelable:!1});var t=document.createEvent("Event");return t.initEvent("scrollend",n,!1),t}(t))}}),f=function(){window.cancelAnimationFrame(b.rafId);w()};window.addEventListener("wheel",f,{passive:!0,once:!0});window.addEventListener("touchmove",f,{passive:!0,once:!0});it(b)}else y(l,a)}},y=function(n){return function(i,r,u){var s,h=t((s=i).window===s?[a(i.document.documentElement),"Window"]:[i,"Element"],2),o=h[0],c=h[1],f=null!=r?r:{};if(!nt(f))throw new TypeError(d(n,c));if(!k(f.behavior))throw new TypeError(g(n,c,f.behavior));"scrollBy"===n&&(f.left=e(f.left)+o.scrollLeft,f.top=e(f.top)+o.scrollTop);dt(o,f,u)}},o=y("scroll"),s=y("scrollTo"),h=y("scrollBy"),rt=o,gt=s,ni=h,ti=o,ii=s,ri=h,ut=function(n){switch(n){case"horizontal-tb":case"lr":case"lr-tb":case"rl":case"rl-tb":return 0;case"vertical-rl":case"tb":case"tb-rl":return 1;case"vertical-lr":case"tb-lr":return 2;case"sideways-rl":return 3;case"sideways-lr":return 4}return 0},ft=function(n,i,r,u){var e,f=0;switch(i||(f^=2),n){case 0:f=f>>1|(1&f)<<1;r=(e=t([u,r],2))[0];u=e[1];break;case 1:case 3:f^=1;break;case 4:f^=2}return[f,r,u]},ui=function(n){return 1==(1&ft(ut(n.writingMode),"rtl"!==n.direction,void 0,void 0)[0])},et=function(n,t,i,r,u,f,e){return 0!==n?n:u<t&&f>i||u>t&&f<i?null:u<=t&&e<=r||f>=i&&e>=r?2:f>i&&e<r||u<t&&e>r?3:null},ot=function(n){return"visible"!==n&&"clip"!==n},fi=function(n,t){return(n.clientHeight<n.scrollHeight||n.clientWidth<n.scrollWidth)&&(ot(t.overflowY)||ot(t.overflowX)||n===a(n))},st=function(n){var t=n.parentNode,i=n.parentElement;if(null===i&&null!==t){if(11===t.nodeType)return t.host;if(9===t.nodeType)return function(n){var t;try{return(null===(t=n.ownerDocument.defaultView)||void 0===t?void 0:t.frameElement)||null}catch(n){return null}}(n)}return i},p=function(n,t,i){return n<t?t:n>i?i:n},c=function(n,t,i){switch(n){case 1:return(t+i)/2;case 3:return i;case 2:case 0:return t}},ei=function(n,i){var f,e,o,r=null===(f=n.ownerDocument.defaultView)||void 0===f?void 0:f.visualViewport,u=t(n===a(n)?[0,0,null!==(e=null==r?void 0:r.width)&&void 0!==e?e:n.clientWidth,null!==(o=null==r?void 0:r.height)&&void 0!==o?o:n.clientHeight]:[i.left,i.top,n.clientWidth,n.clientHeight],4),c=u[0],l=u[1],v=u[2],y=u[3],s=c+n.clientLeft,h=l+n.clientTop;return[h,s+v,h+y,s]},oi=function(n,i){var v=[],y=n.ownerDocument,w=y.defaultView,l;if(!w)return v;for(var s=window.getComputedStyle(n),vt="rtl"!==s.direction,ot=t(function(n,i,r){var u=t(ft(i,r,n.block||"start",n.inline||"nearest"),3),f=u[0];return[u[1],u[2]].map(function(n,t){switch(n){case"center":return 1;case"nearest":return 0;default:return"start"===n==!(f>>t&1)?2:3}})}(i,ut(s.writingMode||s.getPropertyValue("-webkit-writing-mode")||s.getPropertyValue("-ms-writing-mode")),vt),2),yt=ot[0],pt=ot[1],h=t(function(n,t,i){var u,f=t.top,e=t.right,o=t.bottom,s=t.left,h=(u=n.ownerDocument,["scroll-margin","scroll-snap-margin"].filter(function(n){return n in u.documentElement.style})[0]),r;return h?(r=function(n){var t=i.getPropertyValue("".concat(h,"-").concat(n));return parseInt(t,10)||0},[f-r("top"),e+r("right"),o+r("bottom"),s-r("left")]):[f,e,o,s]}(n,n.getBoundingClientRect(),s),4),u=h[0],f=h[1],e=h[2],o=h[3],r=st(n);null!==r;r=st(r)){if(y!==r.ownerDocument){if(!(w=(y=r.ownerDocument).defaultView))break;var ht=r.getBoundingClientRect(),ct=ht.left,lt=ht.top;u+=lt;f+=ct;e+=lt;o+=ct}if(l=w.getComputedStyle(r),"fixed"===l.position)break;if(fi(r,l)){var wt=r.getBoundingClientRect(),a=t(ei(r,wt),4),b=a[0],k=a[1],d=a[2],g=a[3],nt=et(yt,g,k,r.clientWidth,o,f,f-o),tt=et(pt,b,d,r.clientHeight,u,e,e-u),at=null===nt?0:c(nt,o,f)-c(nt,g,k),bt=null===tt?0:c(tt,u,e)-c(tt,b,d),it=ui(l)?p(at,-r.scrollWidth+r.clientWidth-r.scrollLeft,-r.scrollLeft):p(at,-r.scrollLeft,r.scrollWidth-r.clientWidth-r.scrollLeft),rt=p(bt,-r.scrollTop,r.scrollHeight-r.clientHeight-r.scrollTop);v.push([r,{left:r.scrollLeft+it,top:r.scrollTop+rt,behavior:i.behavior}]);u=Math.max(u-rt,b);f=Math.min(f-it,k);e=Math.min(e-rt,d);o=Math.max(o-it,g)}}return v},ht=function(n,i,r){var u=i||{};if(!k(u.behavior))throw new TypeError(g("scrollIntoView","Element",u.behavior));oi(n,u).forEach(function(n){var i=t(n,2),u=i[0],f=i[1];rt(u,f,r)})},w=ht,i=function(n,t){return function(i){if(!l(i)){var r={scroll:o,scrollTo:s,scrollBy:h}[n];t(n,function(){var n=arguments;1!==arguments.length?r(this,{left:n[0],top:n[1]}):r(this,n[0],i)})}}},ct=i("scroll",f),lt=i("scrollTo",f),at=i("scrollBy",f),b=function(n,t){tt(t);r(window,n);window[n]=t},vt=i("scroll",b),yt=i("scrollTo",b),pt=i("scrollBy",b),wt=function(n){if(!l(n)){var t=r(window.HTMLElement.prototype,"scrollIntoView",si);f("scrollIntoView",function(){var i=arguments,r=i[0];1===i.length&&nt(r)?w(this,r,n):t.apply(this,i)})}};return n.elementScroll=rt,n.elementScrollBy=ni,n.elementScrollByPolyfill=at,n.elementScrollIntoView=w,n.elementScrollIntoViewPolyfill=wt,n.elementScrollPolyfill=ct,n.elementScrollTo=gt,n.elementScrollToPolyfill=lt,n.polyfill=function(n){l(n)||(ct(n),lt(n),at(n),wt(n),vt(n),yt(n),pt(n))},n.scroll=o,n.scrollBy=h,n.scrollIntoView=ht,n.scrollTo=s,n.windowScroll=ti,n.windowScrollBy=ri,n.windowScrollByPolyfill=pt,n.windowScrollPolyfill=vt,n.windowScrollTo=ii,n.windowScrollToPolyfill=yt,n}({}),printData,originalSongText,language,originalKey,originalUseFlats,originalUseSolfege,setListPrintData,pageLinesGroups,initialResized,loadedInVersions,newKeyRequest,keyOptions,chordChartIsFlat,usingSolfege,lastFontSize,arialSongText,MIN_FONT_SIZE,MAX_FONT_SIZE,lineHeight,chordChart;"object"==typeof module&&(module.exports=seamless);var prefix=window.location.origin.includes("local")?"":"https://thecabinet20230725181154.azurewebsites.net",mainUrl=prefix+"/api/ChordChart",dbUrl=prefix+"/api/Songs",pageName=getPageName();var currentHovering=-1,numResults=0,loadingInitialSearchResults=!1;printData=JSON.parse(localStorage.getItem("printData"));language="English";document.addEventListener("DOMContentLoaded",function(){pageName=="imprimiendo"&&(language="Spanish");let t=new URLSearchParams(window.location.search).get("display");!t||(get("displayType").value=t,t=="Lyrics"?hideChordOptions():activateChordOptions());let r=localStorage.getItem("chordColor");!r||setChordColor(r);let u=new URLSearchParams(window.location.search).get("songs");if(!!u){loadNewSetList(u);return}let i=new URLSearchParams(window.location.search).get("song");if(!!i){loadNewSong(i);var e=window.location.href.split("?")[0]+"?song_id="+i.split("-")[0];history.replaceState(null,"",e);return}let f=JSON.parse(localStorage.getItem("specialPrintRequest"));if(!!f){printData=f;savePrintData();localStorage.removeItem("specialPrintRequest");localStorage.removeItem("setListPrintData");loadCurrentPrintData();return}let n=new URLSearchParams(window.location.search).get("song_id");if(!n&&!!localStorage.getItem("setListPrintData")){setListPrintData=JSON.parse(localStorage.getItem("setListPrintData"));selectSetListSong(0);buildPages();return}if(!!printData&&(!n||printData.id==n)){loadCurrentPrintData();return}if(!!n){loadNewSong(n);return}goHome()});window.addEventListener("load",function(){setupSlidingMenus();setupPrintMeun();fetch(dbUrl+"/start")});pageLinesGroups=[];let chordChartElement=get("chordChart");initialResized=!1;loadedInVersions=!1;keyOptions=[["LA","SIb","SI","DO","REb","RE","MIb","MI","FA","SOLb","SOL","LAb"],["LA","LA#","SI","DO","DO#","RE","RE#","MI","FA","FA#","SOL","SOL#"],["A","Bb","B","C","Db","D","Eb","E","F","Gb","G","Ab"],["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"]];chordChartIsFlat=!1;usingSolfege=!1;MIN_FONT_SIZE=parseFloat(get("fontSizeSelect").children[0].value);MAX_FONT_SIZE=parseFloat(get("fontSizeSelect").children[get("fontSizeSelect").children.length-1].value);lineHeight=0;