function getPageName(){return window.location.pathname.endsWith(".html")?window.location.pathname.substring(1,window.location.pathname.length-5):window.location.pathname.substring(1,window.location.pathname.length)}function usingSpanish(){return language=="Spanish"}function get(n){return document.getElementById(n)}function getAll(n){return Array.from(document.querySelectorAll(n))}function getFirst(n){return document.querySelector(n)}function getAllClass(n){return Array.from(document.getElementsByClassName(n))}function removeChildren(n){while(n.firstChild)n.removeChild(n.firstChild)}function forEachClassElement(n,t){getAllClass(n).forEach(n=>{t(n)})}function forEachElement(n,t){Array.from(document.querySelectorAll(n)).forEach(function(n){t(n)})}function clickedOn(n,t){return n.target.closest("#"+t)===get(t)}function clickedOnClass(n,t){return!!n.target.closest("."+t)}function setUpChoiceGroup(n,t){let i=Array.from(document.querySelectorAll(n));i.forEach(function(n){n.addEventListener("click",function(){i.forEach(function(n){n.classList.remove("chosen")});this.classList.add("chosen");t(n)})})}function addMiddleClickEvent(n,t){n.addEventListener("mousedown",n=>{n.which===2&&(n.preventDefault(),t(n))})}function openInNewTab(n){let t=make("a");t.href=n;t.target="_blank";t.click()}function scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})}function make(n){return document.createElement(n)}function build(n){let t=document.createElement(n.type);return n.class?t.classList.add(n.class):!n.classes||n.classes.forEach(n=>t.classList.add(n)),!n.id||(t.id=n.id),!n.title||(t.title=n.title),!n.innerHTML||(t.innerHTML=n.innerHTML),n.child?t.appendChild(n.child):!n.children||n.children.forEach(n=>t.appendChild(n)),!n.onclick||t.addEventListener("click",n.onclick),t}function buildTextInput(n){n.type="input";let t=build(n);return t.type="text",t.classList.add("hoverInput"),!n.value||(t.value=n.value),n.noEvents||t.addEventListener("keydown",i=>{switch(i.key){case"Escape":if(!!n.onEscape)n.onEscape(t);t.blur();return;case"Enter":if(!!n.onEnter)n.onEnter(t);t.blur();return}}),t}function buildImage(n){n.type="img";let t=build(n);return t.src="imgs/icons/"+n.src,t.alt=n.alt?n.alt:n.src.split(".")[0],t}function buildDropdownOption(n,t,i){return build({type:"div","class":"dropdownOption",onclick:i,children:[buildImage({src:n}),build({type:"span",innerHTML:t})]})}function buildDropdown(n,t,i){let r=build({type:"div","class":"dropdown",children:t}),u=function(){document.body.contains(r)&&document.body.removeChild(r)};r.addEventListener("mouseleave",u);r.addEventListener("click",u);document.addEventListener("scroll",function f(n){n.currentTarget.removeEventListener(n.type,f);u()});i?r.style.left=n.clientX+window.pageXOffset-10+"px":r.style.right=document.documentElement.clientWidth-window.pageXOffset-n.clientX-10+"px";r.style.top=n.clientY+window.pageYOffset-10+"px";translateNodeToCurrentLanguage(r);document.body.appendChild(r)}function buildSongLink(n,t,i,r){let u=make("div");u.title=r;u.classList.add("songLink");let f=make("img");return f.src="imgs/icons/"+n,f.alt=t,u.appendChild(f),u.appendChild(i),u}function noDBConnection(n){return n.status===503}function search(){sessionStorage.setItem("search",get("searchInput").value);handleSearchRequest()}function promptToSongs(n){sessionStorage.setItem("prompt",n);window.location.href="databaseSongs.html"}function clearSearchData(){sessionStorage.removeItem("search");clearRefineSearchData()}function clearRefineSearchData(){sessionStorage.removeItem("resultTypeSearch");sessionStorage.removeItem("languageSearch");sessionStorage.removeItem("styles");sessionStorage.removeItem("lyricsSearch")}function loadSearchEvents(n){get("searchButton").addEventListener("click",function(){if(onHomePage()&&numResults==0){get("searchInput").focus();return}search()});searchInput.addEventListener("focus",()=>{searchInput.select(),numResults>0&&get("searchContainer").classList.add("hasResults"),get("searchBar").classList.add("focused"),get("searchResults").classList.remove("hidden")});searchInput.addEventListener("blur",function(){get("searchBar").classList.remove("focused");get("searchContainer").classList.remove("hasResults");get("searchResults").classList.add("hidden")});searchInput.addEventListener("keydown",function(n){let t=1;switch(n.key){case"Escape":this.value="";return;case"Enter":search();this.blur();return;case"ArrowUp":t=-1;case"ArrowDown":if(numResults===0)return;currentHovering>=0&&getDropdownResult(currentHovering).classList.remove("hovering");currentHovering===-1&&t===-1&&(currentHovering=0);currentHovering+=t;currentHovering>=numResults&&(currentHovering-=numResults);currentHovering<0&&(currentHovering+=numResults);let n=getDropdownResult(currentHovering);n.classList.add("hovering");this.value=n.name;return}});n?searchInput.addEventListener("input",updateSearchResults):searchInput.addEventListener("input",updateSearchResultsForDBPage)}function getDropdownResult(n){return get("searchResults").childNodes[n]}function updateSearchResults(n){let i=get("searchInput").value,t=get("searchResults");if(i.length===0){removeChildren(t);get("searchContainer").classList.remove("hasResults");numResults=0;loadingInitialSearchResults=!1;return}if(numResults==0&&!loadingInitialSearchResults){loadingInitialSearchResults=!0;let n=make("div");n.classList.add("searchResult");let i=make("div");i.classList.add("centerItems");n.appendChild(i);let r=make("img");r.src="imgs/icons/note.png";i.appendChild(r);let u=make("div");n.appendChild(u);u.innerHTML=usingSpanish()?"Buscando...":"Searching...";removeChildren(t);t.appendChild(n);get("searchContainer").classList.add("hasResults")}fetch(dbUrl+"/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchText:i,language:language,token:localStorage.getItem("token")})}).then(n=>n.json()).then(r=>{if(removeChildren(t),currentHovering=-1,loadingInitialSearchResults=!1,noDBConnection(r)){let n=make("div");n.classList.add("searchResult");let i=make("div");i.classList.add("centerItems");n.appendChild(i);let r=make("img");r.src="imgs/icons/noResults.png";i.appendChild(r);let u=make("div");n.appendChild(u);u.innerHTML="Unable to connect";t.appendChild(n);get("searchContainer").classList.add("hasResults");return}if(numResults=r.length,numResults===0){showNoResults();return}t.classList.contains("hidden")||get("searchContainer").classList.add("hasResults");r.forEach(function(n){let r=n.songName,u=r.toLowerCase().replaceAll("�","n").replaceAll("�","a").replaceAll("�","e").replaceAll("�","i").replaceAll("�","o").replaceAll("�","u").replaceAll("�","u");u=u.replace(new RegExp("("+i+")","ig"),"<strong-$1>/strong-");for(let n=0;n<u.length;n++)switch(u.charAt(n)){case"<":r=[r.slice(0,n),"<strong>",r.slice(n)].join("");n+=7;break;case">":r=[r.slice(0,n),"<\/strong>",r.slice(n)].join("");n+=8}let f=build({type:"div","class":"searchResult",children:[build({type:"div","class":"centerItems",child:buildIcon("note.png")}),build({type:"div",innerHTML:r})]});f.addEventListener("mousedown",function(){window.location.href=(usingSpanish()?"imprimir":"print")+"?song_id="+n.id});f.name=n.songName;f.dataset.songId=n.id;t.appendChild(f)});trySelectFirstOption(n)})}function updateSearchResultsForDBPage(n){let i=get("searchInput").value,t=get("searchResults");if(i.length===0){removeChildren(t);get("searchContainer").classList.remove("hasResults");numResults=0;loadingInitialSearchResults=!1;return}if(numResults==0&&!loadingInitialSearchResults){loadingInitialSearchResults=!0;let n=make("div");n.classList.add("searchResult");let i=make("div");i.classList.add("centerItems");n.appendChild(i);let r=make("img");r.src="imgs/icons/note.png";i.appendChild(r);let u=make("div");n.appendChild(u);u.innerHTML=usingSpanish()?"Buscando...":"Searching...";removeChildren(t);t.appendChild(n);get("searchContainer").classList.add("hasResults")}let r=!limitToCurrentLanguage?dbUrl+"/songNames/"+i:dbUrl+"/songNames/"+language+"/"+i;fetch(r).then(n=>n.json()).then(r=>{if(removeChildren(t),currentHovering=-1,loadingInitialSearchResults=!1,noDBConnection(r)){let n=make("div");n.classList.add("searchResult");let i=make("div");i.classList.add("centerItems");n.appendChild(i);let r=make("img");r.src="imgs/icons/noResults.png";i.appendChild(r);let u=make("div");n.appendChild(u);u.innerHTML="Unable to connect";t.appendChild(n);get("searchContainer").classList.add("hasResults");return}if(numResults=r.length,numResults===0){get("searchContainer").classList.remove("hasResults");return}t.classList.contains("hidden")||get("searchContainer").classList.add("hasResults");let u=0;r.forEach(function(n){let s=n.resultValue,f=make("div");f.name=s;f.classList.add("searchResult");let h=make("div");h.classList.add("centerItems");f.appendChild(h);let e=make("img");switch(n.resultType){case"song":e.src="imgs/icons/note.png";break;case"artist":e.src="imgs/icons/artist.png";break;case"playlist":e.src="imgs/icons/playlist.png"}h.appendChild(e);let c=make("div");f.appendChild(c);let r=s,o=r.toLowerCase().replaceAll("�","n").replaceAll("�","a").replaceAll("�","e").replaceAll("�","i").replaceAll("�","o").replaceAll("�","u").replaceAll("�","u");o=o.replace(new RegExp("("+i+")","ig"),"<strong-$1>/strong-");for(let n=0;n<o.length;n++)switch(o.charAt(n)){case"<":r=[r.slice(0,n),"<strong>",r.slice(n)].join("");n+=7;break;case">":r=[r.slice(0,n),"<\/strong>",r.slice(n)].join("");n+=8}c.innerHTML=r;f.addEventListener("mousedown",function(){currentHovering=this.dataset.resultNumber;get("searchInput").value=s;search()});f.dataset.resultNumber=u++;t.appendChild(f)});onHomePage()&&trySelectFirstOption(n)})}function onHomePage(){return pageName=="/"||pageName=="home"}function trySelectFirstOption(n){if(currentHovering==-1){let t=get("searchInput"),i=getDropdownResult(0),r=i.name;if(currentHovering=0,i.classList.add("hovering"),n.inputType!="deleteContentBackward"&&r.toLowerCase().startsWith(t.value.toLowerCase())){let u=t.value.length;t.value=i.name;createSelection(t,u,i.name.length);return}}}function createSelection(n,t,i){if(n.createTextRange){var r=n.createTextRange();r.collapse(!0);r.moveStart("character",t);r.moveEnd("character",i);r.select()}else n.setSelectionRange?n.setSelectionRange(t,i):n.selectionStart&&(n.selectionStart=t,n.selectionEnd=i)}function showNoResults(){let i=get("searchResults"),n=make("div");n.classList.add("searchResult");let t=make("div");t.classList.add("centerItems");n.appendChild(t);let r=make("img");r.src="imgs/icons/noResults.png";t.appendChild(r);let u=make("div");u.innerHTML=usingSpanish()?"No Resultados":"No Results";n.appendChild(u);i.appendChild(n);i.classList.remove("hidden");get("searchContainer").classList.add("hasResults")}function handleSearchRequest(){if(numResults!=0){let n=getDropdownResult(currentHovering);n&&(window.location.href=(usingSpanish()?"imprimir":"print")+"?song_id="+n.dataset.songId)}}function setupSearchPopup(){let n=get("popupSearchInput"),t=function(){n.value="";get("popupClearSearchButton").classList.add("hidden");get("popupNoResults").classList.add("hidden");get("popupLoadingResults").classList.add("hidden");removeChildren(get("popupSearchResults"))};get("searchBar").addEventListener("click",function(){window.outerWidth>450&&window.outerHeight>600||(get("searchPopup").classList.remove("hidden"),document.body.classList.add("popped"),n.focus())});get("popupCancelSearchButton").addEventListener("click",function(){get("searchPopup").classList.add("hidden");document.body.classList.remove("popped");t()});get("popupClearSearchButton").addEventListener("click",function(){t();n.focus()});get("popupSearchInputButton").addEventListener("click",function(){n.focus()});n.addEventListener("keydown",function(t){switch(t.key){case"Enter":n.blur();return}});n.addEventListener("input",updatePopupSearchResults)}function noDBConnection(n){return n.status===503}function buildIcon(n){let t=make("img");return t.src="imgs/icons/"+n,t}function updatePopupSearchResults(){let t=get("popupSearchInput").value,n=get("popupSearchResults");if(get("popupNoResults").classList.add("hidden"),t.length>0)get("popupClearSearchButton").classList.remove("hidden");else{get("popupClearSearchButton").classList.add("hidden");removeChildren(n);return}get("popupSearchResults").children.length==0&&get("popupLoadingResults").classList.remove("hidden");fetch(dbUrl+"/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchText:t,language:language,token:localStorage.getItem("token")})}).then(n=>n.json()).then(t=>{if(removeChildren(n),get("popupLoadingResults").classList.add("hidden"),noDBConnection(t)){get("popupNoResults").classList.remove("hidden");return}if(t.length===0){get("popupNoResults").classList.remove("hidden");return}t.forEach(function(t){let i=build({type:"div","class":"popupSearchResult",children:[build({type:"div",children:[buildIcon("note.png"),build({type:"span",innerHTML:t.songName})]}),build({type:"span",innerHTML:!t.artist?"-":(usingSpanish()?"por ":"by ")+t.artist})],onclick:function(){window.location.href=(usingSpanish()?"imprimir":"print")+"?song_id="+t.id}});n.appendChild(i)})})}var mainUrl="/api/ChordChart",dbUrl="/api/Songs",pageName=getPageName(),currentHovering=-1,numResults=0,loadingInitialSearchResults=!1,language="Spanish",limitToCurrentLanguage=!0;window.addEventListener("DOMContentLoaded",function(){loadSearchEvents(!0)});window.addEventListener("load",function(){pageName=="home"&&(language="English");let n=!1;get("languageMenuContainer").addEventListener("click",t=>{clickedOn(t,"languageOptions")||(n=!n,get("languageMenuContainer").classList.toggle("open"))});document.addEventListener("click",t=>{!n||clickedOn(t,"languageMenuContainer")||clickedOn(t,"languageOptions")||(n=!1,get("languageMenuContainer").classList.remove("open"))});setupSearchPopup();fetch(dbUrl+"/start")});