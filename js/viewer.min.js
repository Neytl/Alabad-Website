function getPageName(){return window.location.pathname.endsWith(".html")?window.location.pathname.substring(1,window.location.pathname.length-5):window.location.pathname.substring(1,window.location.pathname.length)}function usingSpanish(){return language=="Spanish"}function get(n){return document.getElementById(n)}function getAll(n){return Array.from(document.querySelectorAll(n))}function removeChildren(n){while(n.firstChild)n.removeChild(n.firstChild)}function make(n){return document.createElement(n)}function buildIcon(n,t){let i=make("img");return i.src="imgs/icons/"+n,!t||i.classList.add(t),i}function build(n){let t=document.createElement(n.type);return n.class?t.classList.add(n.class):!n.classes||n.classes.forEach(n=>t.classList.add(n)),!n.id||(t.id=n.id),!n.title||(t.title=n.title),!n.innerHTML||(t.innerHTML=n.innerHTML),n.child?t.appendChild(n.child):!n.children||n.children.forEach(n=>t.appendChild(n)),!n.src||(t.src=n.src),!n.onclick||t.addEventListener("click",n.onclick),t}function deleteElement(n){!n||n.remove()}function clickedOn(n,t){return n.target.closest("#"+t)===get(t)}function onDomLoad(){(pageName=="charts"||pageName=="chart")&&(language="English");!localStorage.getItem("lightMode")||(document.documentElement.classList.add("lightMode"),get("darkModeIcon").src="imgs/icons/light-mode.png")}function setupSharedEvents(){fetch(dbUrl+"/start");getAll(".menuSectionTitle").forEach(n=>{n.classList.contains("noToggle")||n.addEventListener("click",function(){this.parentElement.classList.toggle("closed")})});get("returnToCenterCover").addEventListener("click",function(){currentMenu=null;seamless.scrollIntoView(get("contentContainer"),{behavior:"smooth",block:"start",inline:"start"},{duration:350});get("contentContainer").classList.remove("dark")});get("darkModeButton").addEventListener("click",function(){document.documentElement.classList.toggle("lightMode")?(localStorage.setItem("lightMode",!0),get("darkModeIcon").src="imgs/icons/light-mode.png"):(localStorage.removeItem("lightMode"),get("darkModeIcon").src="imgs/icons/dark-mode.png")});setupSearchPopup();let i=function(){get("contentContainer").scrollIntoView({inline:"start",block:"start"});get("contentContainer").classList.remove("dark")};window.addEventListener("resize",i);let n=!1;get("languageMenuContainer").addEventListener("click",t=>{clickedOn(t,"languageOptions")||(n=!n,get("languageMenuContainer").classList.toggle("open"))});document.addEventListener("click",t=>{!n||clickedOn(t,"languageMenuContainer")||clickedOn(t,"languageOptions")||(n=!1,get("languageMenuContainer").classList.remove("open"))});let t=!1;get("accountMenuContainer").addEventListener("click",n=>{clickedOn(n,"accountMenu")||(t=!t,get("accountMenuContainer").classList.toggle("open"))});document.addEventListener("click",n=>{!t||clickedOn(n,"accountMenuContainer")||clickedOn(n,"accountMenu")||(t=!1,get("accountMenuContainer").classList.remove("open"))});getAll("img").forEach(n=>n.draggable=!1)}function setupSearchPopup(){let n=get("searchInput"),t=function(){n.value="";get("clearSearchButton").classList.add("hidden");get("noResults").classList.add("hidden");get("popupLoadingResults").classList.add("hidden");removeChildren(get("searchResults"))};get("searchButton").addEventListener("click",function(){get("searchPopup").classList.remove("hidden");n.focus()});get("cancelSearchButton").addEventListener("click",function(){get("searchPopup").classList.add("hidden");t()});get("searchInput").addEventListener("keydown",function(n){switch(n.key){case"Escape":get("searchPopup").classList.add("hidden");t()}});get("clearSearchButton").addEventListener("click",function(){t();n.focus()});get("searchInputButton").addEventListener("click",function(){n.focus()});n.addEventListener("keydown",function(t){switch(t.key){case"Enter":n.blur();return}});n.addEventListener("input",updateSearchResults)}function noDBConnection(n){return n.status===503}function updateSearchResults(){let t=get("searchInput").value,n=get("searchResults");if(get("noResults").classList.add("hidden"),t.length>0)get("clearSearchButton").classList.remove("hidden");else{get("clearSearchButton").classList.add("hidden");removeChildren(n);return}n.children.length==0&&get("popupLoadingResults").classList.remove("hidden");fetch(dbUrl+"/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({searchText:t,language:showUnfinishedSongs?null:language,showUnfinishedSongs:showUnfinishedSongs,token:localStorage.getItem("token")})}).then(n=>n.json()).then(t=>{if(removeChildren(n),get("popupLoadingResults").classList.add("hidden"),noDBConnection(t)){get("noResults").classList.remove("hidden");return}if(t.length===0){get("noResults").classList.remove("hidden");return}t.forEach(function(t){let i="-";!t.artist||(i=t.artist,i.startsWith("[")||(i=usingSpanish()?"por "+i:"by "+i));t.isChartCompleted||(i+=usingSpanish()?" *INACABADO*":" *UNFINISHED*");let r=build({type:"div","class":"searchResult",children:[build({type:"div",children:[buildIcon("note.png"),build({type:"span",innerHTML:t.songName})]}),build({type:"span",innerHTML:i})]});r.addEventListener("click",function(){window.location.href=(usingSpanish()?"tabla?song_id=":"chart?song_id=")+t.id});n.appendChild(r)})})}function goHome(){window.location.href=usingSpanish()?"/":"charts"}function onResize(){centerSection.classList.remove("dark");centerSection.scrollIntoView({inline:"start",block:"start"});fitCurrentSong()}function updateTranslatedPageLink(){let n=window.location.href;get("currentPageLink").href=n;n=pageName=="tabla"?n.replace("tabla","chart"):n.replace("chart","tabla");get("translatedPageLink").href=n}function setupGestures(){function t(){r=0}const f=150,e=200,o=25,s=.38;let u=0,n={},r=0,i=null;pagesContainer.addEventListener("touchstart",t=>{if(!(t.changedTouches.length>1)){!i||(clearTimeout(i),i=null);u=Date.now();let r=t.changedTouches[0];n.pageX=r.pageX;n.pageY=r.pageY}});pagesContainer.addEventListener("touchend",h=>{if(!(h.changedTouches.length>1)){let p=Date.now()-u;if(p>e)return t();let a=h.changedTouches[0],w=Math.max(Math.abs(a.pageX-n.pageX),Math.abs(a.pageY-n.pageY));if(w>o)return t();r++;const v=pagesContainer.offsetWidth*s;let c=n.pageX<pagesContainer.offsetWidth/2&&n.pageX<v,l=!c&&n.pageX>pagesContainer.offsetWidth/2&&pagesContainer.offsetWidth-n.pageX<v,y=function(){if(r==1){if(!c&&!l)return toggleFullscreen(),t();let i=pagesContainer.children.length,n=Math.round(pagesContainer.scrollLeft/pagesContainer.offsetWidth);if(c&&n==0||l&&n==i-1)return t();c?pagesContainer.children[n-1].scrollIntoView({inline:"start",block:"start"}):pagesContainer.children[n+1].scrollIntoView({inline:"start",block:"start"})}else if(r==2){if(displayingIndividualSong||!c&&!l)return get("settingsMenuButton").click(),t();for(let n=0;n<setListData.songs.length;n++)if(setListData.songs[n].id==songData.id){if(c&&n==0||l&&n==setListData.songs.length-1)return t();c?get("songId"+setListData.songs[n-1].id).scrollIntoView({inline:"start",block:"start"}):get("songId"+setListData.songs[n+1].id).scrollIntoView({inline:"start",block:"start"});break}}t()};c||l?(i=null,y()):i=setTimeout(y,f)}})}function toggleFullscreen(){inFullscreen=!inFullscreen;return}function replaceUrlWithSetList(){history.replaceState(null,"",window.location.href.split("?")[0]+"?set_list="+(setListData.setId?setListData.setId:"local"));updateTranslatedPageLink()}function pushSetListUrl(){history.replaceState(null,"",window.location.href.split("?")[0]+"?set_list="+(setListData.setId?setListData.setId:"local"));updateTranslatedPageLink()}function saveSetListData(){setListData?localStorage.setItem("setListData",JSON.stringify(setListData)):localStorage.removeItem("setListData")}function createSetList(){setListData={};setListData.songs=[];setListData.setListName="Set List";addCurrentSongToSetList();pushSetListUrl();get("createSetListSection").classList.add("hidden");get("setListSongsSection").classList.remove("hidden")}function updateAddSongToSetListButton(){setListData&&songData&&!setListData.lastUpdate&&(isCurrentSongInSetList()?(get("addCurrentSongButton").classList.add("hidden"),setListData.songs.length<MAX_SET_LIST_SONGS&&get("addNewSongToSetListButton").classList.remove("hidden")):(setListData.songs.length<MAX_SET_LIST_SONGS&&get("addCurrentSongButton").classList.remove("hidden"),get("addNewSongToSetListButton").classList.add("hidden")))}function isCurrentSongInSetList(){if(!setListData||!songData)return!1;for(let n=0;n<setListData.songs.length;n++)if(setListData.songs[n].id==songData.id)return!0;return!1}function deleteSetList(){(setListData=null,localStorage.removeItem("setListData"),get("setListSongsSection").classList.add("hidden"),removeChildren(get("setListSongs")),get("createSetListSection").classList.remove("hidden"),displayingIndividualSong)||(displayingIndividualSong=!0,history.replaceState(null,"",window.location.href.split("?")[0]+"?song_id="+songData.id),fitCurrentSong())}function addCurrentSongToSetList(){setListData.songs.push(songData);saveSetListData();updateSetListLinks();updateAddSongToSetListButton();addSongDataToSetListSection(songData,!0);displayingIndividualSong=!1;replaceUrlWithSetList();fitSetListSongs()}function addNewSongToSetList(){sessionStorage.setItem("addingASong",!0);currentMenu=null;centerSection.classList.remove("dark");centerSection.scrollIntoView({inline:"start",block:"start"});get("searchButton").click()}function loadNewSetListData(n,t){fetch(dbUrl+"/setList/"+n).then(n=>n.json()).then(n=>{if(noDBConnection(n)||n.title==="Not Found"||n.title==="Bad Request"){goHome();return}setListData={};setListData.songs=n;setListData.setListName=t?decodeURIComponent(t):"Set List";songData=setListData.songs[0];saveCurrentSongData();setUpCurrentSetListMetadata();displayNewSong()})}function setUpCurrentSetListMetadata(){setListData&&(get("setListName").innerHTML=setListData.setListName,setListData.songs.forEach(n=>{addSongDataToSetListSection(n)}),setListData.lastUpdate?(get("editSetListSongButton").classList.add("hidden"),get("saveSetListSongButton").classList.add("hidden"),get("addCurrentSongButton").classList.add("hidden"),get("addNewSongToSetListButton").classList.add("hidden"),displayingIndividualSong?get("deleteSetListButton").classList.remove("hidden"):get("deleteSetListButton").classList.add("hidden"),isLoggedIn()?(get("unlockSetListSongButton").classList.remove("hidden"),get("shareSetListButton").classList.remove("hidden"),get("printSetListButton").classList.remove("hidden")):(get("unlockSetListSongButton").classList.add("hidden"),get("shareSetListButton").classList.add("hidden"),get("printSetListButton").classList.add("hidden"))):(get("editSetListSongButton").classList.remove("hidden"),get("shareSetListButton").classList.remove("hidden"),get("printSetListButton").classList.remove("hidden"),get("deleteSetListButton").classList.remove("hidden"),get("unlockSetListSongButton").classList.add("hidden"),isLoggedIn()?get("saveSetListSongButton").classList.remove("hidden"):get("saveSetListSongButton").classList.add("hidden")),get("createSetListSection").classList.add("hidden"),get("setListSongsSection").classList.remove("hidden"),updateAddSongToSetListButton(),updateSetListLinks())}function addSongDataToSetListSection(n,t){let i=build({type:"div","class":"setListSong",children:[buildIcon("note.png","setListActive"),buildIcon("move.png","setListEditing"),build({type:"div","class":"setListSongName",children:[build({type:"span",innerHTML:n.songName}),build({type:"span","class":"setListArtist",innerHTML:!n.artist?usingSpanish()?"(No Artista)":"(No Artist)":"("+n.artist+")"})]}),build({type:"div",classes:["deleteSetListSong","setListEditing"],child:buildIcon("trash.png"),onclick:function(){removeSongFromSetList(n.id)}}),],onclick:function(){if(!editingSetList){if(editingTheSong){get("returnToCenterCover").click();return}displayingIndividualSong&&(saveAndDisplayNewSetListSongMetadata(n),fitSetListSongs(),pushSetListUrl());get("songId"+n.id).scrollIntoView({inline:"start",block:"start"});get("setListSongsSection").scrollIntoView({inline:"start",block:"start"});displayingIndividualSong=!1;get("returnToCenterCover").click()}}});!t||i.classList.add("currentSetSong");get("setListSongs").appendChild(i)}function saveAndDisplayNewSetListSongMetadata(n){songData=n;sessionStorage.setItem("songData",JSON.stringify(songData));saveOriginalSongInfo();showSongDetails();buildKeyButtons(songData.chordChartIsFlat,songData.usingSolfege,songData.isMinorKey,songData.key);showKeyChanges(songData.keyChanges);usingFlats=songData.chordChartIsFlat;usingSolfege=songData.usingSolfege;setFlatsVisual();setSolfegeVisual()}function updateSetListLinks(){updateSetListYTLink();updateSetListPrintLink()}function updateSetListYTLink(){if(setListData){let n=[];if(setListData.songs.forEach(t=>{!t.songLink||n.push(t.songLink.split("?v=")[1])}),n.length==0){get("setListLink").classList.add("hidden");return}let t="https://www.youtube.com/watch_videos?video_ids="+n[0];for(let i=1;i<n.length;i++)t+=","+n[i];get("setListLink").href=t;get("setListLink").classList.remove("hidden")}}function updateSetListPrintLink(){if(setListData){if(setListData.songs.forEach(n=>{n.idWithFlags||(n.idWithFlags=n.id+n.flags)}),setListData.songs.length==1){get("printSetListButton").href=(usingSpanish()?"imprimiendo?":"printing?")+(!!displayType&&displayType!="Chords"?"display="+displayType+"&":"")+"song="+setListData.songs[0].idWithFlags;return}let n=(usingSpanish()?"imprimiendo?":"printing?")+(!!displayType&&displayType!="Chords"?"display="+displayType+"&":"")+"songs="+setListData.songs[0].idWithFlags;for(let t=1;t<setListData.songs.length;t++)n+=","+setListData.songs[t].idWithFlags;get("printSetListButton").href=n}}function loadNewSavedSetList(n,t){fetch(dbUrl+"/setListById/"+n).then(n=>{if(n.ok)return n.json()}).then(n=>{if(setListData=n,songData=null,!!t)for(let n=0;n<setListData.songs.length;n++)if(setListData.songs[n].id==t){songData=setListData.songs[n];break}songData||(songData=setListData.songs[0]);saveCurrentSongData();setUpCurrentSetListMetadata();displayNewSong()})}function checkForSavedSetUpdates(){fetch(dbUrl+"/setListLastUpdate/"+setListData.setId).then(n=>n.json()).then(n=>{noDBConnection(n)||n.title==="Not Found"||n.title==="Bad Request"||n==setListData.lastUpdate?(setUpCurrentSetListMetadata(),displayNewSong()):loadNewSavedSetList(setListData.setId,songData.id)})}function editSetList(){editingSetList=!0;get("setListSongsSection").classList.add("editing");sortable.option("disabled",!1);get("editSetListName").value=setListData.setListName;get("setListName").classList.add("hidden");get("editSetListNameContainer").classList.remove("hidden")}function unlockSetlist(){setListData.lastUpdate=null;removeChildren(get("setListSongs"));setUpCurrentSetListMetadata()}function cancelSetListChanges(){editingSetList=!1;sortable.option("disabled",!0);get("setListSongsSection").classList.remove("editing");get("editSetListNameContainer").classList.add("hidden");get("setListName").classList.remove("hidden");removeChildren(get("setListSongs"));setListData=JSON.parse(localStorage.getItem("setListData"));setListData.lastUpdate=null;setUpCurrentSetListMetadata()}function confirmSetListChanges(){if(editingSetList=!1,sortable.option("disabled",!0),get("setListSongsSection").classList.remove("editing"),setListData.songs.length==0){deleteSetList();return}if(setListData.setListName=get("editSetListName").value,get("setListName").innerHTML=setListData.setListName,get("editSetListNameContainer").classList.add("hidden"),get("setListName").classList.remove("hidden"),saveSetListData(),updateAddSongToSetListButton(),updateSetListLinks(),!displayingIndividualSong){if(!isCurrentSongInSetList()){songData=setListData.songs[0];sessionStorage.setItem("songData",JSON.stringify(songData));displayNewSong();return}fitSetListSongs()}}function removeSongFromSetList(n){for(let t=0;t<setListData.songs.length;t++)if(setListData.songs[t].id==n){setListData.songs.splice(t,1);get("setListSongs").removeChild(get("setListSongs").children[t]);return}}function loadNewSong(n){fetch(dbUrl+"/song/"+n).then(n=>n.json()).then(n=>{noDBConnection(n)||n.title==="Not Found"||(songData=n,songData.idWithFlags=songData.id+songData.flags,saveCurrentSongData(),updateAddSongToSetListButton(),displayNewSong(),!sessionStorage.getItem("addingASong")||(!setListData||isCurrentSongInSetList()||(!setListData.setId||(setListData.lastUpdate=null,get("editSetListSongButton").classList.remove("hidden"),get("unlockSetListSongButton").classList.add("hidden"),get("saveSetListSongButton").classList.remove("hidden"),get("editSetListSongButton").classList.remove("hidden"),get("deleteSetListButton").classList.remove("hidden")),addCurrentSongToSetList()),sessionStorage.removeItem("addingASong")))})}function saveCurrentSongData(){editingTheSong||(songWasChanged=!0,sessionStorage.setItem("songData",JSON.stringify(songData)),saveSetListData())}function reloadSongData(){if(songData=JSON.parse(sessionStorage.getItem("songData")),setListData=JSON.parse(localStorage.getItem("setListData")),!!setListData&&!displayingIndividualSong)for(let n=0;n<setListData.songs.length;n++)if(setListData.songs[n].id==songData.id){setListData.songs[n]=songData;break}}function displayNewSong(){saveOriginalSongInfo();showSongDetails();showSongVariants()}function saveOriginalSongInfo(){originalSongText=songData.text;originalKey=songData.key;originalUseFlats=songData.chordChartIsFlat;originalUseSolfege=songData.usingSolfege}function showSongVariants(){fitCurrentSong();buildKeyButtons(songData.chordChartIsFlat,songData.usingSolfege,songData.isMinorKey,songData.key);showKeyChanges(songData.keyChanges);usingFlats=songData.chordChartIsFlat;usingSolfege=songData.usingSolfege;setFlatsVisual();setSolfegeVisual()}function showSongDetails(){if(get("songDataName").innerHTML=songData.songName,document.title=songData.songName+" - Alabad",songData.artist?(get("songDataArtist").innerHTML=songData.artist,get("songDataArtistContainer").classList.remove("hidden")):get("songDataArtistContainer").classList.add("hidden"),songData.songLink?(get("songDataYT").href=songData.songLink,get("songDataYTContainer").classList.remove("hidden")):get("songDataYTContainer").classList.add("hidden"),songData.idWithFlags||(songData.idWithFlags=songData.id+songData.flags),get("printButton").href=(usingSpanish()?"imprimiendo?":"printing?")+(!!displayType&&displayType!="Chords"?"display="+displayType+"&":"")+"song="+songData.idWithFlags,!!setListData){let n=document.querySelector(".currentSetSong");if(!n||n.classList.remove("currentSetSong"),!!new URLSearchParams(window.location.search).get("song_id"))return;for(let n=0;n<setListData.songs.length;n++)if(setListData.songs[n].id==songData.id){get("setListSongs").children[n].classList.add("currentSetSong");break}}}function buildKeyButtons(n,t,i,r){r!=originalKey?get("originalKeyButton").classList.remove("hidden"):get("originalKeyButton").classList.add("hidden");let u=[];u=t?n?keyOptions[0]:keyOptions[1]:n?keyOptions[2]:keyOptions[3];let f=get("keyButtons");removeChildren(f);u.forEach(function(n){i&&(n+="m");let t=make("div");t.innerHTML=n.replace("#","♯").replace("b","♭");n===r?t.classList.add("selectedKey"):t.addEventListener("click",function(){transposeTo(n)});f.appendChild(t)})}function showKeyChanges(n){if(!!n&&n.length>1){let t=n[0];for(let i=1;i<n.length;i++)t+=" ➔ "+n[i];get("keyChanges").innerHTML=t;get("keyChangesContaienr").classList.remove("hidden")}else get("keyChangesContaienr").classList.add("hidden")}function setFlatsVisual(){usingFlats?(get("toFlatsButton").classList.add("selected"),get("toSharpsButton").classList.remove("selected")):(get("toSharpsButton").classList.add("selected"),get("toFlatsButton").classList.remove("selected"))}function convertToFlats(){usingFlats||(usingFlats=!0,setFlatsVisual(),postTextAndDisplay())}function convertToSharps(){usingFlats&&(usingFlats=!1,setFlatsVisual(),postTextAndDisplay())}function setSolfegeVisual(){usingSolfege?(get("toSolfegeButton").classList.add("selected"),get("toLettersButton").classList.remove("selected")):(get("toLettersButton").classList.add("selected"),get("toSolfegeButton").classList.remove("selected"))}function convertToLetters(){usingSolfege&&(usingSolfege=!1,setSolfegeVisual(),postTextAndDisplay())}function convertToSolfege(){usingSolfege||(usingSolfege=!0,setSolfegeVisual(),postTextAndDisplay())}function checkUpdatePrintButtons(){songWasChanged&&(updateSetListPrintLink(),get("printButton").href=(usingSpanish()?"imprimiendo?":"printing?")+(!!displayType&&displayType!="Chords"?"display="+displayType+"&":"")+"song="+songData.idWithFlags,songWasChanged=!1)}async function printSong(){if(!!songData.fontSize||displayType!="Chords"){printSongWithoutUpdating();return}await fetch(dbUrl+"/printSettings/"+songData.id).then(n=>n.json()).then(n=>{n.title&&n.title=="Not Found"||(songData.fontSize=n.fontSize,songData.numColumns=n.numColumns,saveCurrentSongData()),printSongWithoutUpdating()})}function printSongWithoutUpdating(){songData.displayType=displayType;songData.newPrintRequest=!0;localStorage.setItem("printData",JSON.stringify(songData))}function transposeTo(n){newKeyRequest=n;postTextAndDisplay()}function postTextAndDisplay(){let t=!get("songEditingContainer").classList.contains("hidden"),n={text:originalSongText,key:songData.key,chordChartIsFlat:usingFlats,usingSolfege:usingSolfege};t&&(n.text=get("songEditingText").value);!newKeyRequest||(n.key=newKeyRequest,newKeyRequest=undefined);!songData.language||(n.language=songData.language);fetch(mainUrl+"/parseText",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(n=>n.json()).then(n=>{updateSongData(n),t&&(saveOriginalSongInfo(),get("songEditingText").value=n.text),showSongVariants()})}function updateSongData(n){songData.text=n.text;songData.lyrics=n.lyrics;songData.html=n.html;songData.shortenedChart=n.shortenedChart;songData.title=n.title;songData.usingSolfege=n.usingSolfege;songData.chordChartIsFlat=n.chordChartIsFlat;songData.key=n.key;songData.keyChanges=n.keyChanges;songData.idWithFlags=songData.id+n.flags;saveCurrentSongData()}function setDisplayType(n){displayType!=n&&(get("show"+displayType+"Button").classList.remove("currentDisplayType"),get("show"+n+"Button").classList.add("currentDisplayType"),songWasChanged=!0,displayType=n,localStorage.setItem("displayType",n),fitCurrentSong());get("infoMenu").scrollIntoView({inline:"end",block:"start"});get("returnToCenterCover").click()}function loadSongVersions(){loadedInVersions||(loadedInVersions=!0,songData.songVersions?displayVersions():fetch(dbUrl+"/versions/"+songData.id).then(n=>n.json()).then(n=>{songData.songVersions=n,saveCurrentSongData(),displayVersions()}))}function displayVersions(){if(songData.songVersions.length==0){get("versions").appendChild(build({type:"div",children:[buildIcon("close.png"),build({type:"span",innerHTML:usingSpanish()?"No Resultados":"No Versions Found"})],onclick:function(){get("moreVersionsButton").click()}}));return}songData.songVersions.forEach(n=>{get("versions").appendChild(build({type:"div",children:[buildIcon("note.png"),build({type:"div",children:[build({type:"span",innerHTML:songData.songName}),build({type:"span",innerHTML:!n.artist?usingSpanish()?" (No Artista)":" (No Artist)":" ("+n.artist+")"})]})],onclick:function(){window.location.href=(usingSpanish()?"tabla?song_id=":"chart?song_id=")+n.id}}))})}function fitCurrentSong(){if(get("songEditingContainer").classList.contains("hidden")){if(!displayingIndividualSong&&!editingTheSong){fitSetListSongs();return}let n=[];if(!!songData.pageElementsText&&confirmSongHash(songData))songData.pageElementsText.forEach(t=>{n.push(createElementFromString(t))});else{n=songTextToPages(getSongTextToDisplay(songData));let t=!0;songData.pageElementsText=[];n.forEach(n=>{n.dataset.song=songData.id,t&&(t=!1,n.id="songId"+songData.id),songData.pageElementsText.push(n.outerHTML)});setSongHash(songData);saveCurrentSongData()}removeChildren(pagesContainer);pagesContainer.style.gridTemplateColumns="repeat("+n.length+", 100vw)";pagesContainer.classList.add("fitted");n.forEach(n=>{pagesContainer.appendChild(n)})}}function fitSetListSongs(){sizingASetList=!0;let n=[],t=!1;setListData.songs.forEach(i=>{if(!!i.pageElementsText&&confirmSongHash(i))i.pageElementsText.forEach(t=>{n.push(createElementFromString(t))});else{t=!0;let r=songTextToPages(getSongTextToDisplay(i)),u=!0;r.forEach(t=>{t.dataset.song=i.id,u&&(u=!1,t.id="songId"+i.id),n.push(t)});i.pageElementsText=[];r.forEach(n=>{i.pageElementsText.push(n.outerHTML)});setSongHash(i)}});t&&saveCurrentSongData();removeChildren(pagesContainer);pagesContainer.style.gridTemplateColumns="repeat("+n.length+", 100vw)";pagesContainer.classList.add("fitted");n.forEach(n=>{pagesContainer.appendChild(n)});get("songId"+songData.id).scrollIntoView({inline:"start",block:"start"});currentMenu=="Chords"?get("chordsMenu").scrollIntoView({inline:"start",block:"start"}):currentMenu=="Settings"&&get("settingsMenu").scrollIntoView({inline:"start",block:"start"});setTimeout(function(){sizingASetList=!1},100)}function songTextToPages(n){removeChildren(pagesContainer);pagesContainer.style.gridTemplateColumns="";pagesContainer.classList.remove("fitted");var t,i;if(n.startsWith("<span class='lineGroup title fullLine'>")){let r=n.indexOf("<\/span>")+7;t=n.substring(0,r);i=n.slice(r)}else t="",i=n;let r=[];return songElement=build({type:"div","class":"songText"}),pagesContainer.appendChild(songElement),setScreenProportions(),htmlFitsOnOnePage(t,i)?r.push(htmlToPageHelper(t,i)):(dontSplitSections=!1,htmlFitsOnOnePage(t,i)?r.push(htmlToPageHelper(t,i)):r=htmlToPagesHelper(t,i)),r}function setScreenProportions(){dontSplitSections=!0;pagesContainer.classList.remove("scrollable");let n=window.getComputedStyle(pagesContainer,null).getPropertyValue("padding"),t=parseFloat(n.substring(0,n.length-2));screenWidth=window.innerWidth-2*t;screenHeight=window.innerHeight-2*t-get("nav").offsetHeight;screenProportion=screenWidth/screenHeight;tempMaxSongScale=maxSongScale}function getProportion(n){return resetSongScale(),songElement.innerHTML=n,songElement.offsetWidth/songElement.offsetHeight}function resetSongScale(){setSongScale(1)}function setSongScale(n){n>tempMaxSongScale&&(n=tempMaxSongScale);songElement.style.scale=n}function displaySizedHTML(n,t){setSongScale(t);songElement.innerHTML=n;let i=songElement.querySelector(".title");!i||(i.style.maxWidth=screenWidth/t+"px")}function displaySizedToWidthHTML(n){displaySizedHTML(n,getScaleToReachWidth(n))}function getScaleToReachWidth(n){return resetSongScale(),songElement.innerHTML=n,screenWidth/songElement.offsetWidth-.001}function getScaleToReachHeight(n){return resetSongScale(),songElement.innerHTML=n,screenHeight/songElement.offsetHeight-.001}function htmlToPageHelper(n,t,i,r){if(i||(i=n+t),!r&&getProportion(i)>screenProportion)return displaySizedToWidthHTML(i),buildCurrentPage();r||(r=1);let u=getSplitSongText(n,t,r+1);if(r<maxColumns-1&&getProportion(u)<screenProportion)return htmlToPageHelper(n,t,u,r+1);let f=getScaleToReachHeight(i),e;return(e=r<maxColumns-1||getProportion(u)>screenProportion?getScaleToReachWidth(u):getScaleToReachHeight(u),f+bonusToLessColumns>e||f>dontSplitSongIfAlreadyAtScale)?(displaySizedHTML(i,f),buildCurrentPage()):(displaySizedHTML(u,e),buildCurrentPage())}function buildCurrentPage(){return build({type:"div","class":"page",child:duplicateElement(songElement)})}function htmlToPagesHelper(n,t){let r="<span class='lineGroup SS",u=t.split(r),i=[],f=0,o=u.length-1;while(f!=o){let t=Math.ceil((o+f)/2-.1),i=u.slice(0,t+1).join(r);htmlFitsOnOnePage(n,i)?f=t:o=t-1}let s=u.slice(0,f+1).join(r),e=r+u.slice(f+1,u.length).join(r);i.push(htmlToPageHelper(n,s));let h=Math.min(maxSongScale,parseFloat(songElement.style.scale)+scaleDifferenceBetweenPages);return tempMaxSongScale=h,dontSplitSections=!0,htmlFitsOnOnePage("",e)?i.push(htmlToPageHelper("",e)):(dontSplitSections=!1,htmlFitsOnOnePage("",e)?i.push(htmlToPageHelper("",e)):i=i.concat(htmlToPagesHelper("",e))),i}function htmlFitsOnOnePage(n,t,i,r){if(i||(i=n+t),!r&&getProportion(i)>screenProportion)return!0;r||(r=1);let u=getSplitSongText(n,t,r+1);if(r<maxColumns-1&&getProportion(u)<screenProportion)return getScaleToReachWidth(u)<minSongScale?!1:htmlFitsOnOnePage(n,t,u,r+1);let e=getScaleToReachHeight(i),f;return(f=r<maxColumns-1||getProportion(u)>screenProportion?getScaleToReachWidth(u):getScaleToReachHeight(u),e<minSongScale-sizingMarginForError&&f<minSongScale-sizingMarginForError)?!1:!0}function getSplitSongText(n,t,i){return dontSplitSections?getSplitSongText1(n,t,i):getSplitSongText2(n,t,i)}function getSplitSongText1(n,t,i){let e="<span class='lineGroup SS",r=t.split(e);for(let n=1;n<r.length;n++)r[n]=e+r[n];let u=[];u.push(r);for(let n=1;n<i;n++)u.push([]);resetSongScale();optimize(u,0,i);let f=n+"<div id='songTextColumns'>";return u.forEach(n=>{f+="<div>",n.forEach(n=>{f+=n}),f+="<\/div>"}),f+"<\/div>"}function optimize(n,t,i){if(i!=1&&!(n[t].length<=1)){let r=getHeight(n,t),u=copyColumns(n);while(n[t].length>1){let e=n[t].pop();n[t+1].unshift(e);optimize(n,t+1,i-1);let f=getHeight(n,t);if(f<r)r=f,u=copyColumns(n);else{for(let t=0;t<n.length;t++)n[t]=u[t];return}}}}function getHeight(n,t){let i="<div id='songTextColumns'>";for(let r=t;r<n.length;r++)i+="<div>",n[r].forEach(n=>{i+=n}),i+="<\/div>";return songElement.innerHTML=i+"<\/div>",songElement.offsetHeight}function copyColumns(n){let t=[];for(let i=0;i<n.length;i++)t[i]=[...n[i]];return t}function getSplitSongText2(n,t,i){resetSongScale();songElement.innerHTML=t;let f=songElement.offsetHeight/i,u="",r="";for(let n=0;n<i-1;n++){for(n!=0&&(songElement.innerHTML=r,r="");songElement.offsetHeight>f;){let n=songElement.removeChild(songElement.firstChild);n.innerHTML.includes("lyrics sectionTitle")&&(r+=n.outerHTML,n=songElement.removeChild(songElement.firstChild));r+=n.outerHTML}u="<div>"+songElement.innerHTML+"<\/div>"+u}return n+"<div id='songTextColumns'><div>"+r+"<\/div>"+u+"<\/div>"}function confirmSongHash(n){return n.sizedSongHash==buildSongHash(n)}function setSongHash(n){n.sizedSongHash=buildSongHash(n)}function buildSongHash(n){return window.innerWidth+"x"+window.innerHeight+"_"+n.id+"_"+displayType+"_"+n.key+"_"+(!n.chordChartIsFlat?"F":"T")+"_"+(!n.usingSolfege?"F":"T")}function getSongTextToDisplay(n){return displayType=="Lyrics"?n.lyrics:displayType=="Complete"?n.html:n.shortenedChart}function createElementFromString(n){const t=document.createElement("div");return t.innerHTML=n,t.firstElementChild}function duplicateElement(n){return createElementFromString(n.outerHTML)}function loadLoggedInFeatures(){get("loggedInUser").innerHTML=localStorage.getItem("loggedInUser");get("openLoginPopupButton").classList.add("hidden");get("accountMenuContainer").classList.remove("hidden");get("editSongSection").classList.remove("hidden");!setListData||(setListData.lastUpdate?(get("unlockSetListSongButton").classList.remove("hidden"),get("shareSetListButton").classList.remove("hidden"),get("printSetListButton").classList.remove("hidden")):get("saveSetListSongButton").classList.remove("hidden"))}function unloadLoggedInFeatures(){get("accountMenuContainer").classList.add("hidden");get("openLoginPopupButton").classList.remove("hidden");showUnfinishedSongs=!1;get("editSongSection").classList.add("hidden");!setListData||(setListData.lastUpdate?(get("unlockSetListSongButton").classList.add("hidden"),get("shareSetListButton").classList.add("hidden"),get("printSetListButton").classList.add("hidden")):get("saveSetListSongButton").classList.add("hidden"))}function setupSongEditing(){get("editSongButton").addEventListener("click",function(){get("editSongSection").classList.add("hidden");get("viewOrEditSongContainer").classList.remove("hidden");pagesContainer.classList.add("hidden");get("songEditingText").value=songData.text;editingTheSong=!0;get("songEditingContainer").classList.remove("hidden");get("songEditingText").scrollTop=0;get("returnToCenterCover").click()});get("viewEditsButton").addEventListener("click",function(){get("viewEditsButton").classList.add("hidden");get("continueEditingButton").classList.remove("hidden");get("songEditingContainer").classList.add("hidden");get("cancelOrSaveChangesContainer").classList.remove("hidden");let n={text:get("songEditingText").value};!songData.language||(n.language=songData.language);fetch(mainUrl+"/parseText",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(n=>n.json()).then(n=>{updateSongData(n),saveOriginalSongInfo(),pagesContainer.classList.remove("hidden"),songData.sizedSongHash=null,showSongVariants()})});get("continueEditingButton").addEventListener("click",function(){get("continueEditingButton").classList.add("hidden");get("viewEditsButton").classList.remove("hidden");pagesContainer.classList.add("hidden");get("songEditingText").value=songData.text;get("songEditingContainer").classList.remove("hidden");get("songEditingText").scrollTop=0;get("cancelOrSaveChangesContainer").classList.add("hidden")});get("saveSongEditsButton").addEventListener("click",function(){confirm("Save edits to '"+songData.songName+"'?")&&(get("viewOrEditSongContainer").classList.add("hidden"),get("cancelOrSaveChangesContainer").classList.add("hidden"),get("continueEditingButton").classList.add("hidden"),get("viewEditsButton").classList.remove("hidden"),get("editSongSection").classList.remove("hidden"),editingTheSong=!1,fetch(updateCabinetURL+"/updateText",{method:"PATCH",body:JSON.stringify({id:songData.id,text:songData.text,partOfSetList:displayingIndividualSong||!setListData?null:setListData.setId}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(n=>{if(!n.ok){switch(n.status){case 401:runLogout();alert("Update failed: Login timed out");get("editSongButton").click();openLoginPopup();return;case 503:runLogout();alert("Update failed: Could not connect to the database");break;case 400:alert("Update failed: Invalid request");break;default:alert("Update failed")}reloadSongData();saveOriginalSongInfo();showSongVariants();return}songData.sizedSongHash=null;saveCurrentSongData();displayingIndividualSong||fitSetListSongs();return}))});get("cancelSongEditsButton").addEventListener("click",function(){confirm("Undo changes to '"+songData.songName+"'?")&&(get("viewOrEditSongContainer").classList.add("hidden"),get("cancelOrSaveChangesContainer").classList.add("hidden"),get("continueEditingButton").classList.add("hidden"),get("viewEditsButton").classList.remove("hidden"),get("editSongSection").classList.remove("hidden"),editingTheSong=!1,reloadSongData(),saveOriginalSongInfo(),get("songEditingContainer").classList.add("hidden"),pagesContainer.classList.remove("hidden"),showSongVariants())})}function setupLoginEvents(){get("openLoginPopupButton").addEventListener("click",openLoginPopup);get("logOutButton").addEventListener("click",runLogout);get("closeLoginPopupButton").addEventListener("click",closeLoginPopup);get("loginPopupContainer").addEventListener("click",function(n){n.target.closest("#loginPopup")!=get("loginPopup")&&closeLoginPopup()});get("loginUsername").addEventListener("focus",clearLoginMessage);get("loginPassword").addEventListener("focus",clearLoginMessage);get("loginUsername").addEventListener("keypress",n=>{n.key=="Enter"&&(get("loginUsername").blur(),get("loginButton").click())});get("loginPassword").addEventListener("keypress",n=>{n.key=="Enter"&&(get("loginPassword").blur(),get("loginButton").click())});get("loginButton").addEventListener("click",function(){if(!get("loginUsername").value){setLoginMessage("Enter your username");return}if(!get("loginPassword").value){setLoginMessage("Enter your password");return}runLogin()});let n=localStorage.getItem("timeLoggedIn");n?(n=parseInt(n),(Date.now()-n)/36e5>5&&runLogout()):runLogout()}function setLoginMessage(n){get("loginMessage").innerHTML=n;get("loginMessage").classList.add("active")}function clearLoginMessage(){get("loginMessage").classList.remove("active")}function clearLoginFields(){get("loginUsername").value="";get("loginPassword").value=""}function runLogin(){localStorage.setItem("connection","loggingIn");fetch(loginURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Username:get("loginUsername").value,Password:get("loginPassword").value})}).then(n=>{n.ok?onValidLogin(n):n.status===401?(localStorage.removeItem("token"),localStorage.setItem("connection","loggedOut"),setLoginMessage("Username or password is incorrect")):n.status===503&&(get("loginPassword").value="",localStorage.setItem("connection","noConnection"),setLoginMessage("Login failed: Could not connect to the database"))})}async function onValidLogin(n){let i=await n.json(),t=JSON.stringify(i);localStorage.setItem("token",t.substring(1,t.length-1));localStorage.setItem("timeLoggedIn",Date.now());localStorage.setItem("loggedInUser",get("loginUsername").value);get("loginPassword").value="";onConnectionEstablished()}function openLoginPopup(){get("loginPopupContainer").classList.remove("hidden")}function closeLoginPopup(){get("loginPopupContainer").classList.add("hidden");clearLoginFields();clearLoginMessage()}function testDatabaseEditorConnection(){let n=localStorage.getItem("connection");if(n!="noConnection"){if(n=="loggedIn"){let n=localStorage.getItem("timeLoggedIn");if(!n){runLogout();return}if(n=parseInt(n),(Date.now()-n)/36e5>5){runLogout();return}loadLoggedInFeatures();return}let t=localStorage.getItem("token");if(!t){localStorage.setItem("connection","loggedOut");return}fetch(updateCabinetURL+"/testConnection",{headers:{Authorization:"Bearer "+t}}).then(n=>{if(n.ok){onConnectionEstablished();return}n.status===401?(localStorage.removeItem("token"),localStorage.setItem("connection","loggedOut")):n.status===503&&(localStorage.setItem("connection","noConnection"),setLoginMessage("Login failed: Could not connect to the database"))})}}function onConnectionEstablished(){localStorage.setItem("connection","loggedIn");closeLoginPopup();loadLoggedInFeatures();showUnfinishedSongs||get("showUnfinishedSongsToggle").click()}function runLogout(){unloadLoggedInFeatures();localStorage.setItem("connection","loggedOut");localStorage.removeItem("showUnfinishedSongs");localStorage.removeItem("token");localStorage.removeItem("timeLoggedIn");localStorage.removeItem("loggedInUser")}function isLoggedIn(){return localStorage.getItem("connection")=="loggedIn"}var seamless=function(n){"use strict";function t(n,t){var i="function"==typeof Symbol&&n[Symbol.iterator],r,f,u,e;if(!i)return n;u=i.call(n);e=[];try{for(;(void 0===t||t-->0)&&!(r=u.next()).done;)e.push(r.value)}catch(n){f={error:n}}finally{try{r&&!r.done&&(i=u.return)&&i.call(u)}finally{if(f)throw f.error;}}return e}function bt(n,t){this.scrollLeft=n;this.scrollTop=t}function v(){var n,t;return v=t=(null===(n=window.performance)||void 0===n?void 0:n.now)?function(){return window.performance.now()}:function(){return window.Date.now()},t()}function si(n){w(this,{block:null==n||n?"start":"end",inline:"nearest"})}var u=function(){return u=Object.assign||function(n){for(var r,i,t=1,u=arguments.length;t<u;t++)for(i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i]);return n},u.apply(this,arguments)},k=function(n){return void 0===n||"auto"===n||"instant"===n||"smooth"===n},d=function(n,t,i){return void 0===i&&(i="cannot convert to dictionary."),"Failed to execute '".concat(n,"' on '").concat(t,"': ").concat(i)},g=function(n,t,i){return d(n,t,"The provided value '".concat(i,"' is not a valid enum value of type ScrollBehavior."))},r=function(n,t,i){var r,u="__SEAMLESS.BACKUP$".concat(t);return n[u]||!n[t]||(null===(r=n[t])||void 0===r?void 0:r.__isPolyfill)||(n[u]=n[t]),n[u]||i},nt=function(n){var t=typeof n;return null!==n&&("object"===t||"function"===t)},l=function(n){return"scrollBehavior"in window.document.documentElement.style&&!0!==(null==n?void 0:n.forcePolyfill)},tt=function(n){Object.defineProperty(n,"__isPolyfill",{value:!0})},f=function(n,t){tt(t);[HTMLElement.prototype,SVGElement.prototype,Element.prototype].forEach(function(i){r(i,n);i[n]=t})},a=function(n){return n.ownerDocument.scrollingElement||n.ownerDocument.documentElement},kt=function(n){return.5*(1-Math.cos(Math.PI*n))},it=function(n){var t=(v()-n.timeStamp)/(n.duration||500);if(t>1)return n.method(n.targetX,n.targetY),void n.callback();var i=(n.timingFunc||kt)(t),r=n.startX+(n.targetX-n.startX)*i,u=n.startY+(n.targetY-n.startY)*i;n.method(r,u);n.rafId=window.requestAnimationFrame(function(){it(n)})},e=function(n){return isFinite(n)?Number(n):0},dt=function(n,t,i){var o,s,p,y;if(function(n){var t;return null!==(t=n.isConnected)&&void 0!==t?t:!(n.ownerDocument&&1&n.ownerDocument.compareDocumentPosition(n))}(n)){var h=n.scrollLeft,c=n.scrollTop,l=e(null!==(o=t.left)&&void 0!==o?o:h),a=e(null!==(s=t.top)&&void 0!==s?s:c);if(l!==h||a!==c)if(p=r(HTMLElement.prototype,"scroll",bt),y=r(Object.getPrototypeOf(n),"scroll",p).bind(n),"smooth"===t.behavior){var w=function(){window.removeEventListener("wheel",f);window.removeEventListener("touchmove",f)},b=u(u({},i),{timeStamp:v(),startX:h,startY:c,targetX:l,targetY:a,rafId:0,method:y,callback:function(){w();var t=9===n.nodeType;n.dispatchEvent(function(n){if("function"==typeof Event)return new Event("scrollend",{bubbles:n,cancelable:!1});var t=document.createEvent("Event");return t.initEvent("scrollend",n,!1),t}(t))}}),f=function(){window.cancelAnimationFrame(b.rafId);w()};window.addEventListener("wheel",f,{passive:!0,once:!0});window.addEventListener("touchmove",f,{passive:!0,once:!0});it(b)}else y(l,a)}},y=function(n){return function(i,r,u){var s,h=t((s=i).window===s?[a(i.document.documentElement),"Window"]:[i,"Element"],2),o=h[0],c=h[1],f=null!=r?r:{};if(!nt(f))throw new TypeError(d(n,c));if(!k(f.behavior))throw new TypeError(g(n,c,f.behavior));"scrollBy"===n&&(f.left=e(f.left)+o.scrollLeft,f.top=e(f.top)+o.scrollTop);dt(o,f,u)}},o=y("scroll"),s=y("scrollTo"),h=y("scrollBy"),rt=o,gt=s,ni=h,ti=o,ii=s,ri=h,ut=function(n){switch(n){case"horizontal-tb":case"lr":case"lr-tb":case"rl":case"rl-tb":return 0;case"vertical-rl":case"tb":case"tb-rl":return 1;case"vertical-lr":case"tb-lr":return 2;case"sideways-rl":return 3;case"sideways-lr":return 4}return 0},ft=function(n,i,r,u){var e,f=0;switch(i||(f^=2),n){case 0:f=f>>1|(1&f)<<1;r=(e=t([u,r],2))[0];u=e[1];break;case 1:case 3:f^=1;break;case 4:f^=2}return[f,r,u]},ui=function(n){return 1==(1&ft(ut(n.writingMode),"rtl"!==n.direction,void 0,void 0)[0])},et=function(n,t,i,r,u,f,e){return 0!==n?n:u<t&&f>i||u>t&&f<i?null:u<=t&&e<=r||f>=i&&e>=r?2:f>i&&e<r||u<t&&e>r?3:null},ot=function(n){return"visible"!==n&&"clip"!==n},fi=function(n,t){return(n.clientHeight<n.scrollHeight||n.clientWidth<n.scrollWidth)&&(ot(t.overflowY)||ot(t.overflowX)||n===a(n))},st=function(n){var t=n.parentNode,i=n.parentElement;if(null===i&&null!==t){if(11===t.nodeType)return t.host;if(9===t.nodeType)return function(n){var t;try{return(null===(t=n.ownerDocument.defaultView)||void 0===t?void 0:t.frameElement)||null}catch(n){return null}}(n)}return i},p=function(n,t,i){return n<t?t:n>i?i:n},c=function(n,t,i){switch(n){case 1:return(t+i)/2;case 3:return i;case 2:case 0:return t}},ei=function(n,i){var f,e,o,r=null===(f=n.ownerDocument.defaultView)||void 0===f?void 0:f.visualViewport,u=t(n===a(n)?[0,0,null!==(e=null==r?void 0:r.width)&&void 0!==e?e:n.clientWidth,null!==(o=null==r?void 0:r.height)&&void 0!==o?o:n.clientHeight]:[i.left,i.top,n.clientWidth,n.clientHeight],4),c=u[0],l=u[1],v=u[2],y=u[3],s=c+n.clientLeft,h=l+n.clientTop;return[h,s+v,h+y,s]},oi=function(n,i){var v=[],y=n.ownerDocument,w=y.defaultView,l;if(!w)return v;for(var s=window.getComputedStyle(n),vt="rtl"!==s.direction,ot=t(function(n,i,r){var u=t(ft(i,r,n.block||"start",n.inline||"nearest"),3),f=u[0];return[u[1],u[2]].map(function(n,t){switch(n){case"center":return 1;case"nearest":return 0;default:return"start"===n==!(f>>t&1)?2:3}})}(i,ut(s.writingMode||s.getPropertyValue("-webkit-writing-mode")||s.getPropertyValue("-ms-writing-mode")),vt),2),yt=ot[0],pt=ot[1],h=t(function(n,t,i){var u,f=t.top,e=t.right,o=t.bottom,s=t.left,h=(u=n.ownerDocument,["scroll-margin","scroll-snap-margin"].filter(function(n){return n in u.documentElement.style})[0]),r;return h?(r=function(n){var t=i.getPropertyValue("".concat(h,"-").concat(n));return parseInt(t,10)||0},[f-r("top"),e+r("right"),o+r("bottom"),s-r("left")]):[f,e,o,s]}(n,n.getBoundingClientRect(),s),4),u=h[0],f=h[1],e=h[2],o=h[3],r=st(n);null!==r;r=st(r)){if(y!==r.ownerDocument){if(!(w=(y=r.ownerDocument).defaultView))break;var ht=r.getBoundingClientRect(),ct=ht.left,lt=ht.top;u+=lt;f+=ct;e+=lt;o+=ct}if(l=w.getComputedStyle(r),"fixed"===l.position)break;if(fi(r,l)){var wt=r.getBoundingClientRect(),a=t(ei(r,wt),4),b=a[0],k=a[1],d=a[2],g=a[3],nt=et(yt,g,k,r.clientWidth,o,f,f-o),tt=et(pt,b,d,r.clientHeight,u,e,e-u),at=null===nt?0:c(nt,o,f)-c(nt,g,k),bt=null===tt?0:c(tt,u,e)-c(tt,b,d),it=ui(l)?p(at,-r.scrollWidth+r.clientWidth-r.scrollLeft,-r.scrollLeft):p(at,-r.scrollLeft,r.scrollWidth-r.clientWidth-r.scrollLeft),rt=p(bt,-r.scrollTop,r.scrollHeight-r.clientHeight-r.scrollTop);v.push([r,{left:r.scrollLeft+it,top:r.scrollTop+rt,behavior:i.behavior}]);u=Math.max(u-rt,b);f=Math.min(f-it,k);e=Math.min(e-rt,d);o=Math.max(o-it,g)}}return v},ht=function(n,i,r){var u=i||{};if(!k(u.behavior))throw new TypeError(g("scrollIntoView","Element",u.behavior));oi(n,u).forEach(function(n){var i=t(n,2),u=i[0],f=i[1];rt(u,f,r)})},w=ht,i=function(n,t){return function(i){if(!l(i)){var r={scroll:o,scrollTo:s,scrollBy:h}[n];t(n,function(){var n=arguments;1!==arguments.length?r(this,{left:n[0],top:n[1]}):r(this,n[0],i)})}}},ct=i("scroll",f),lt=i("scrollTo",f),at=i("scrollBy",f),b=function(n,t){tt(t);r(window,n);window[n]=t},vt=i("scroll",b),yt=i("scrollTo",b),pt=i("scrollBy",b),wt=function(n){if(!l(n)){var t=r(window.HTMLElement.prototype,"scrollIntoView",si);f("scrollIntoView",function(){var i=arguments,r=i[0];1===i.length&&nt(r)?w(this,r,n):t.apply(this,i)})}};return n.elementScroll=rt,n.elementScrollBy=ni,n.elementScrollByPolyfill=at,n.elementScrollIntoView=w,n.elementScrollIntoViewPolyfill=wt,n.elementScrollPolyfill=ct,n.elementScrollTo=gt,n.elementScrollToPolyfill=lt,n.polyfill=function(n){l(n)||(ct(n),lt(n),at(n),wt(n),vt(n),yt(n),pt(n))},n.scroll=o,n.scrollBy=h,n.scrollIntoView=ht,n.scrollTo=s,n.windowScroll=ti,n.windowScrollBy=ri,n.windowScrollByPolyfill=pt,n.windowScrollPolyfill=vt,n.windowScrollTo=ii,n.windowScrollToPolyfill=yt,n}({}),language,inFullscreen,editingSetList,keyOptions,usingFlats,usingSolfege,songWasChanged,newKeyRequest,loadedInVersions,sizingASetList,tempMaxSongScale,editingTheSong;"object"==typeof module&&(module.exports=seamless);
/**!
 * Sortable 1.15.3
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */
(function(n,t){typeof exports=="object"&&typeof module!="undefined"?module.exports=t():typeof define=="function"&&define.amd?define(t):(n=n||self,n.Sortable=t())})(this,function(){"use strict";function au(n,t){var r=Object.keys(n),i;return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(n),t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),r.push.apply(r,i)),r}function ot(n){for(var i,t=1;t<arguments.length;t++)i=arguments[t]!=null?arguments[t]:{},t%2?au(Object(i),!0).forEach(function(t){bf(n,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(i)):au(Object(i)).forEach(function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(i,t))});return n}function bi(n){"@babel/helpers - typeof";return bi=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},bi(n)}function bf(n,t,i){return t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i,n}function it(){return it=Object.assign||function(n){for(var i,r,t=1;t<arguments.length;t++){i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])}return n},it.apply(this,arguments)}function kf(n,t){if(n==null)return{};for(var u={},f=Object.keys(n),i,r=0;r<f.length;r++)(i=f[r],t.indexOf(i)>=0)||(u[i]=n[i]);return u}function df(n,t){var u,i,r,f;if(n==null)return{};if(u=kf(n,t),Object.getOwnPropertySymbols)for(f=Object.getOwnPropertySymbols(n),r=0;r<f.length;r++)(i=f[r],t.indexOf(i)>=0)||Object.prototype.propertyIsEnumerable.call(n,i)&&(u[i]=n[i]);return u}function gf(n){return ne(n)||te(n)||ie(n)||re()}function ne(n){if(Array.isArray(n))return pr(n)}function te(n){if(typeof Symbol!="undefined"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function ie(n,t){if(n){if(typeof n=="string")return pr(n,t);var i=Object.prototype.toString.call(n).slice(8,-1);return(i==="Object"&&n.constructor&&(i=n.constructor.name),i==="Map"||i==="Set")?Array.from(n):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?pr(n,t):void 0}}function pr(n,t){(t==null||t>n.length)&&(t=n.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=n[i];return r}function re(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");}function ht(n){if(typeof window!="undefined"&&window.navigator)return!!navigator.userAgent.match(n)}function e(n,t,i){n.addEventListener(t,i,!ct&&wu)}function f(n,t,i){n.removeEventListener(t,i,!ct&&wu)}function ki(n,t){if(t){if(t[0]===">"&&(t=t.substring(1)),n)try{if(n.matches)return n.matches(t);if(n.msMatchesSelector)return n.msMatchesSelector(t);if(n.webkitMatchesSelector)return n.webkitMatchesSelector(t)}catch(i){return!1}return!1}}function bu(n){return n.host&&n!==document&&n.host.nodeType?n.host:n.parentNode}function rt(n,t,i,r){if(n){i=i||document;do{if(t!=null&&(t[0]===">"?n.parentNode===i&&ki(n,t):ki(n,t))||r&&n===i)return n;if(n===i)break}while(n=bu(n))}return null}function c(n,t,i){if(n&&t)if(n.classList)n.classList[i?"add":"remove"](t);else{var r=(" "+n.className+" ").replace(ku," ").replace(" "+t+" "," ");n.className=(r+(i?" "+t:"")).replace(ku," ")}}function t(n,t,i){var r=n&&n.style;if(r){if(i===void 0)return document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(n,""):n.currentStyle&&(i=n.currentStyle),t===void 0?i:i[t];t in r||t.indexOf("webkit")!==-1||(t="-webkit-"+t);r[t]=i+(typeof i=="string"?"":"px")}}function pt(n,i){var r="",u,f;if(typeof n=="string")r=n;else do u=t(n,"transform"),u&&u!=="none"&&(r=u+" "+r);while(!i&&(n=n.parentNode));return f=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix,f&&new f(r)}function du(n,t,i){if(n){var u=n.getElementsByTagName(t),r=0,f=u.length;if(i)for(;r<f;r++)i(u[r],r);return u}return[]}function st(){var n=document.scrollingElement;return n?n:document.documentElement}function s(n,i,r,u,f){var e,o,s,h,c,l,a,y;if(n.getBoundingClientRect||n===window){if(n!==window&&n.parentNode&&n!==st()?(e=n.getBoundingClientRect(),o=e.top,s=e.left,h=e.bottom,c=e.right,l=e.height,a=e.width):(o=0,s=0,h=window.innerHeight,c=window.innerWidth,l=window.innerHeight,a=window.innerWidth),(i||r)&&n!==window&&(f=f||n.parentNode,!ct))do if(f&&f.getBoundingClientRect&&(t(f,"transform")!=="none"||r&&t(f,"position")!=="static")){y=f.getBoundingClientRect();o-=y.top+parseInt(t(f,"border-top-width"));s-=y.left+parseInt(t(f,"border-left-width"));h=o+e.height;c=s+e.width;break}while(f=f.parentNode);if(u&&n!==window){var v=pt(f||n),p=v&&v.a,w=v&&v.d;v&&(o/=w,s/=p,a/=p,l/=w,h=o+l,c=s+a)}return{top:o,left:s,bottom:h,right:c,width:a,height:l}}}function gu(n,t,i){for(var r=lt(n,!0),e=s(n)[t],u,f;r;){if(u=s(r)[i],f=void 0,f=i==="top"||i==="left"?e>=u:e<=u,!f)return r;if(r===st())break;r=lt(r,!1)}return!1}function kt(n,t,r,u){for(var o=0,f=0,e=n.children;f<e.length;){if(e[f].style.display!=="none"&&e[f]!==i.ghost&&(u||e[f]!==i.dragged)&&rt(e[f],r.draggable,n,!1)){if(o===t)return e[f];o++}f++}return null}function wr(n,r){for(var u=n.lastElementChild;u&&(u===i.ghost||t(u,"display")==="none"||r&&!ki(u,r));)u=u.previousElementSibling;return u||null}function a(n,t){var r=0;if(!n||!n.parentNode)return-1;while(n=n.previousElementSibling)n.nodeName.toUpperCase()!=="TEMPLATE"&&n!==i.clone&&(!t||ki(n,t))&&r++;return r}function nf(n){var t=0,i=0,u=st();if(n)do{var r=pt(n),f=r.a,e=r.d;t+=n.scrollLeft*f;i+=n.scrollTop*e}while(n!==u&&(n=n.parentNode));return[t,i]}function ue(n,t){var i,r;for(i in n)if(n.hasOwnProperty(i))for(r in t)if(t.hasOwnProperty(r)&&t[r]===n[i][r])return Number(i);return-1}function lt(n,i){var r,f,u;if(!n||!n.getBoundingClientRect)return st();r=n;f=!1;do if((r.clientWidth<r.scrollWidth||r.clientHeight<r.scrollHeight)&&(u=t(r),r.clientWidth<r.scrollWidth&&(u.overflowX=="auto"||u.overflowX=="scroll")||r.clientHeight<r.scrollHeight&&(u.overflowY=="auto"||u.overflowY=="scroll"))){if(!r.getBoundingClientRect||r===document.body)return st();if(f||i)return r;f=!0}while(r=r.parentNode);return st()}function fe(n,t){if(n&&t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function br(n,t){return Math.round(n.top)===Math.round(t.top)&&Math.round(n.left)===Math.round(t.left)&&Math.round(n.height)===Math.round(t.height)&&Math.round(n.width)===Math.round(t.width)}function tf(n,t){return function(){if(!fi){var i=arguments,r=this;i.length===1?n.call(r,i[0]):n.apply(r,i);fi=setTimeout(function(){fi=void 0},t)}}}function ee(){clearTimeout(fi);fi=void 0}function rf(n,t,i){n.scrollLeft+=t;n.scrollTop+=i}function kr(n){var t=window.Polymer,i=window.jQuery||window.Zepto;return t&&t.dom?t.dom(n).cloneNode(!0):i?i(n).clone(!0)[0]:n.cloneNode(!0)}function uf(n,i){t(n,"position","absolute");t(n,"top",i.top);t(n,"left",i.left);t(n,"width",i.width);t(n,"height",i.height)}function dr(n){t(n,"position","");t(n,"top","");t(n,"left","");t(n,"width","");t(n,"height","")}function ff(n,t,i){var r={};return Array.from(n.children).forEach(function(u){var e,o,h,c,f;rt(u,t.draggable,n,!1)&&!u.animated&&u!==i&&(f=s(u),r.left=Math.min((e=r.left)!==null&&e!==void 0?e:Infinity,f.left),r.top=Math.min((o=r.top)!==null&&o!==void 0?o:Infinity,f.top),r.right=Math.max((h=r.right)!==null&&h!==void 0?h:-Infinity,f.right),r.bottom=Math.max((c=r.bottom)!==null&&c!==void 0?c:-Infinity,f.bottom))}),r.width=r.right-r.left,r.height=r.bottom-r.top,r.x=r.left,r.y=r.top,r}function oe(){var n=[],r;return{captureAnimationState:function(){if(n=[],this.options.animation){var r=[].slice.call(this.el.children);r.forEach(function(r){var u,f;t(r,"display")!=="none"&&r!==i.ghost&&(n.push({target:r,rect:s(r)}),u=ot({},n[n.length-1].rect),r.thisAnimationDuration&&(f=pt(r,!0),f&&(u.top-=f.f,u.left-=f.e)),r.fromRect=u)})}},addAnimationState:function(t){n.push(t)},removeAnimationState:function(t){n.splice(ue(n,{target:t}),1)},animateAll:function(t){var u=this,f,i;if(!this.options.animation){clearTimeout(r);typeof t=="function"&&t();return}f=!1;i=0;n.forEach(function(n){var e=0,t=n.target,o=t.fromRect,r=s(t),l=t.prevFromRect,a=t.prevToRect,h=n.rect,c=pt(t,!0);c&&(r.top-=c.f,r.left-=c.e);t.toRect=r;t.thisAnimationDuration&&br(l,r)&&!br(o,r)&&(h.top-r.top)/(h.left-r.left)==(o.top-r.top)/(o.left-r.left)&&(e=he(h,l,a,u.options));br(r,o)||(t.prevFromRect=o,t.prevToRect=r,e||(e=u.options.animation),u.animate(t,h,r,e));e&&(f=!0,i=Math.max(i,e),clearTimeout(t.animationResetTimer),t.animationResetTimer=setTimeout(function(){t.animationTime=0;t.prevFromRect=null;t.fromRect=null;t.prevToRect=null;t.thisAnimationDuration=null},e),t.thisAnimationDuration=e)});clearTimeout(r);f?r=setTimeout(function(){typeof t=="function"&&t()},i):typeof t=="function"&&t();n=[]},animate:function(n,i,r,u){if(u){t(n,"transition","");t(n,"transform","");var f=pt(this.el),s=f&&f.a,h=f&&f.d,e=(i.left-r.left)/(s||1),o=(i.top-r.top)/(h||1);n.animatingX=!!e;n.animatingY=!!o;t(n,"transform","translate3d("+e+"px,"+o+"px,0)");this.forRepaintDummy=se(n);t(n,"transition","transform "+u+"ms"+(this.options.easing?" "+this.options.easing:""));t(n,"transform","translate3d(0,0,0)");typeof n.animated=="number"&&clearTimeout(n.animated);n.animated=setTimeout(function(){t(n,"transition","");t(n,"transform","");n.animated=!1;n.animatingX=!1;n.animatingY=!1},u)}}}}function se(n){return n.offsetWidth}function he(n,t,i,r){return Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))/Math.sqrt(Math.pow(t.top-i.top,2)+Math.pow(t.left-i.left,2))*r.animation}function oi(n){var r=n.sortable,i=n.rootEl,u=n.name,c=n.targetEl,l=n.cloneEl,a=n.toEl,v=n.fromEl,y=n.oldIndex,w=n.newIndex,b=n.oldDraggableIndex,k=n.newDraggableIndex,d=n.originalEvent,h=n.putSortable,g=n.extraEventProperties,t,f,e,o,s;if(r=r||i&&i[p],r){f=r.options;e="on"+u.charAt(0).toUpperCase()+u.substr(1);!window.CustomEvent||ct||ri?(t=document.createEvent("Event"),t.initEvent(u,!0,!0)):t=new CustomEvent(u,{bubbles:!0,cancelable:!0});t.to=a||i;t.from=v||i;t.item=c||i;t.clone=l;t.oldIndex=y;t.newIndex=w;t.oldDraggableIndex=b;t.newDraggableIndex=k;t.originalEvent=d;t.pullMode=h?h.lastPutMode:undefined;o=ot(ot({},g),ei.getEventProperties(u,r));for(s in o)t[s]=o[s];i&&i.dispatchEvent(t);f[e]&&f[e].call(r,t)}}function k(t){oi(ot({putSortable:w,cloneEl:l,targetEl:n,rootEl:h,oldIndex:gt,oldDraggableIndex:si,newIndex:nt,newDraggableIndex:vt},t))}function i(n,t){var u,f,r;if(!(n&&n.nodeType&&n.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(n));this.el=n;this.options=t=it({},t);n[p]=this;u={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(n.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return cf(n,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(n,t){n.setData("Text",t.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:i.supportPointer!==!1&&"PointerEvent"in window&&!ui,emptyInsertThreshold:5};ei.initializePlugins(this,n,u);for(f in u)f in t||(t[f]=u[f]);lf(t);for(r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this));this.nativeDraggable=t.forceFallback?!1:le;this.nativeDraggable&&(this.options.touchStartThreshold=1);t.supportPointer?e(n,"pointerdown",this._onTapStart):(e(n,"mousedown",this._onTapStart),e(n,"touchstart",this._onTapStart));this.nativeDraggable&&(e(n,"dragover",this),e(n,"dragenter",this));tr.push(this.el);t.store&&t.store.get&&this.sort(t.store.get(this)||[]);it(this,oe())}function ye(n){n.dataTransfer&&(n.dataTransfer.dropEffect="move");n.cancelable&&n.preventDefault()}function or(n,t,i,r,u,f,e,o){var h,c=n[p],l=c.options.onMove,a;return!window.CustomEvent||ct||ri?(h=document.createEvent("Event"),h.initEvent("move",!0,!0)):h=new CustomEvent("move",{bubbles:!0,cancelable:!0}),h.to=t,h.from=n,h.dragged=i,h.draggedRect=r,h.related=u||t,h.relatedRect=f||s(t),h.willInsertAfter=o,h.originalEvent=e,n.dispatchEvent(h),l&&(a=l.call(c,h,e)),a}function uu(n){n.draggable=!1}function pe(){ru=!1}function we(n,t,i){var u=s(kt(i.el,0,i.options,!0)),f=ff(i.el,i.options,r),e=10;return t?n.clientX<f.left-e||n.clientY<u.top&&n.clientX<u.right:n.clientY<f.top-e||n.clientY<u.bottom&&n.clientX<u.left}function be(n,t,i){var u=s(wr(i.el,i.options.draggable)),f=ff(i.el,i.options,r),e=10;return t?n.clientX>f.right+e||n.clientY>u.bottom&&n.clientX>u.left:n.clientY>f.bottom+e||n.clientX>u.right&&n.clientY>u.top}function ke(n,t,i,r,u,f,e,o){var s=r?n.clientY:n.clientX,h=r?i.height:i.width,c=r?i.top:i.left,l=r?i.bottom:i.right,a=!1;if(!e)if(o&&rr<h*u){if(!li&&(ci===1?s>c+h*f/2:s<l-h*f/2)&&(li=!0),li)a=!0;else if(ci===1?s<c+rr:s>l-rr)return-ci}else if(s>c+h*(1-u)/2&&s<l-h*(1-u)/2)return de(t);return(a=a||e,a&&(s<c+h*f/2||s>l-h*f/2))?s>c+h/2?1:-1:0}function de(t){return a(n)<a(t)?1:-1}function ge(n){for(var t=n.tagName+n.className+n.src+n.href+n.textContent,i=t.length,r=0;i--;)r+=t.charCodeAt(i);return r.toString(36)}function no(n){var t,i,r;for(ur.length=0,t=n.getElementsByTagName("input"),i=t.length;i--;)r=t[i],r.checked&&ur.push(r)}function sr(n){return setTimeout(n,0)}function fu(n){return clearTimeout(n)}function to(){function n(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var n in this)n.charAt(0)==="_"&&typeof this[n]=="function"&&(this[n]=this[n].bind(this))}return n.prototype={dragStarted:function(n){var t=n.originalEvent;this.sortable.nativeDraggable?e(document,"dragover",this._handleAutoScroll):this.options.supportPointer?e(document,"pointermove",this._handleFallbackAutoScroll):t.touches?e(document,"touchmove",this._handleFallbackAutoScroll):e(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var t=n.originalEvent;this.options.dragOverBubble||t.rootEl||this._handleAutoScroll(t)},drop:function(){this.sortable.nativeDraggable?f(document,"dragover",this._handleAutoScroll):(f(document,"pointermove",this._handleFallbackAutoScroll),f(document,"touchmove",this._handleFallbackAutoScroll),f(document,"mousemove",this._handleFallbackAutoScroll));pf();lr();ee()},nulling:function(){cr=eu=ai=hr=vi=ou=su=null;y.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,t){var e=this,i=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,u=document.elementFromPoint(i,r),f;if(cr=n,t||this.options.forceAutoScrollFallback||ri||ct||ui)ar(n,this.options,u,t),f=lt(u,!0),hr&&(!vi||i!==ou||r!==su)&&(vi&&pf(),vi=setInterval(function(){var u=lt(document.elementFromPoint(i,r),!0);u!==f&&(f=u,lr());ar(n,e.options,u,t)},10),ou=i,su=r);else{if(!this.options.bubbleScroll||lt(u,!0)===st()){lr();return}ar(n,this.options,lt(u,!1),!1)}}},it(n,{pluginName:"scroll",initializeByDefault:!0})}function lr(){y.forEach(function(n){clearInterval(n.pid)});y=[]}function pf(){clearInterval(vi)}function cu(){}function lu(){}function io(){function n(){this.defaults={swapClass:"sortable-swap-highlight"}}return n.prototype={dragStart:function(n){var t=n.dragEl;ut=t},dragOverValid:function(n){var f=n.completed,t=n.target,e=n.onMove,o=n.activeSortable,s=n.changed,h=n.cancel,u,r,i;o.options.swap&&(u=this.sortable.el,r=this.options,t&&t!==u&&(i=ut,e(t)!==!1?(c(t,r.swapClass,!0),ut=t):ut=null,i&&i!==ut&&c(i,r.swapClass,!1)),s(),f(!0),h())},drop:function(n){var t=n.activeSortable,r=n.putSortable,u=n.dragEl,i=r||this.sortable,f=this.options;ut&&c(ut,f.swapClass,!1);ut&&(f.swap||r&&r.options.swap)&&u!==ut&&(i.captureAnimationState(),i!==t&&t.captureAnimationState(),ro(u,ut),i.animateAll(),i!==t&&t.animateAll())},nulling:function(){ut=null}},it(n,{pluginName:"swap",eventProperties:function(){return{swapItem:ut}}})}function ro(n,t){var i=n.parentNode,r=t.parentNode,f,u;i&&r&&!i.isEqualNode(t)&&!r.isEqualNode(n)&&(f=a(n),u=a(t),i.isEqualNode(r)&&f<u&&u++,i.insertBefore(t,i.children[f]),r.insertBefore(n,r.children[u]))}function uo(){function n(n){for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this));n.options.avoidImplicitDeselect||(n.options.supportPointer?e(document,"pointerup",this._deselectMultiDrag):(e(document,"mouseup",this._deselectMultiDrag),e(document,"touchend",this._deselectMultiDrag)));e(document,"keydown",this._checkKeyDown);e(document,"keyup",this._checkKeyUp);this.defaults={selectedClass:"sortable-selected",multiDragKey:null,avoidImplicitDeselect:!1,setData:function(t,i){var r="";u.length&&et===n?u.forEach(function(n,t){r+=(t?", ":"")+n.textContent}):r=i.textContent;t.setData("Text",r)}}}return n.prototype={multiDragKeyDown:!1,isMultiDrag:!1,delayStartGlobal:function(n){var t=n.dragEl;o=t},delayEnded:function(){this.isMultiDrag=~u.indexOf(o)},setupClone:function(n){var i=n.sortable,r=n.cancel,t;if(this.isMultiDrag){for(t=0;t<u.length;t++)tt.push(kr(u[t])),tt[t].sortableIndex=u[t].sortableIndex,tt[t].draggable=!1,tt[t].style["will-change"]="",c(tt[t],this.options.selectedClass,!1),u[t]===o&&c(tt[t],this.options.chosenClass,!1);i._hideClone();r()}},clone:function(n){var t=n.sortable,i=n.rootEl,r=n.dispatchSortableEvent,f=n.cancel;this.isMultiDrag&&(this.options.removeCloneOnHide||u.length&&et===t&&(wf(!0,i),r("clone"),f()))},showClone:function(n){var i=n.cloneNowShown,r=n.rootEl,u=n.cancel;this.isMultiDrag&&(wf(!1,r),tt.forEach(function(n){t(n,"display","")}),i(),vr=!1,u())},hideClone:function(n){var i=this,f=n.sortable,r=n.cloneNowHidden,u=n.cancel;this.isMultiDrag&&(tt.forEach(function(n){t(n,"display","none");i.options.removeCloneOnHide&&n.parentNode&&n.parentNode.removeChild(n)}),r(),vr=!0,u())},dragStartGlobal:function(n){var t=n.sortable;!this.isMultiDrag&&et&&et.multiDrag._deselectMultiDrag();u.forEach(function(n){n.sortableIndex=a(n)});u=u.sort(function(n,t){return n.sortableIndex-t.sortableIndex});ii=!0},dragStarted:function(n){var i=this,r=n.sortable,f;this.isMultiDrag&&(this.options.sort&&(r.captureAnimationState(),this.options.animation&&(u.forEach(function(n){n!==o&&t(n,"position","absolute")}),f=s(o,!1,!0,!0),u.forEach(function(n){n!==o&&uf(n,f)}),g=!0,pi=!0)),r.animateAll(function(){g=!1;pi=!1;i.options.animation&&u.forEach(function(n){dr(n)});i.options.sort&&yr()}))},dragOver:function(n){var t=n.target,i=n.completed,r=n.cancel;g&&~u.indexOf(t)&&(i(!1),r())},revert:function(n){var i=n.fromSortable,r=n.rootEl,f=n.sortable,t=n.dragRect;u.length>1&&(u.forEach(function(n){f.addAnimationState({target:n,rect:g?s(n):t});dr(n);n.fromRect=t;i.removeAnimationState(n)}),g=!1,fo(!this.options.removeCloneOnHide,r))},dragOverCompleted:function(n){var r=n.sortable,i=n.isOwner,h=n.insertion,t=n.activeSortable,c=n.parentEl,l=n.putSortable,a=this.options,f,e;h&&(i&&t._hideClone(),pi=!1,a.animation&&u.length>1&&(g||!i&&!t.options.sort&&!l)&&(f=s(o,!1,!0,!0),u.forEach(function(n){n!==o&&(uf(n,f),c.appendChild(n))}),g=!0),i||(g||yr(),u.length>1?(e=vr,t._showClone(r),t.options.animation&&!vr&&e&&tt.forEach(function(n){t.addAnimationState({target:n,rect:wi});n.fromRect=wi;n.thisAnimationDuration=null})):t._showClone(r)))},dragOverAnimationCapture:function(n){var r=n.dragRect,f=n.isOwner,i=n.activeSortable,t;u.forEach(function(n){n.thisAnimationDuration=null});i.options.animation&&!f&&i.multiDrag.isMultiDrag&&(wi=it({},r),t=pt(o,!0),wi.top-=t.f,wi.left-=t.e)},dragOverAnimationComplete:function(){g&&(g=!1,yr())},drop:function(n){var l=n.originalEvent,v=n.rootEl,r=n.parentEl,w=n.sortable,rt=n.dispatchSortableEvent,ut=n.oldIndex,k=n.putSortable,y=k||this.sortable,f,i,e,h,d,t,nt,b,it;if(l){if(f=this.options,i=r.children,!ii)if(f.multiDragKey&&!this.multiDragKeyDown&&this._deselectMultiDrag(),c(o,f.selectedClass,!~u.indexOf(o)),~u.indexOf(o))u.splice(u.indexOf(o),1),yi=null,oi({sortable:w,rootEl:v,name:"deselect",targetEl:o,originalEvent:l});else{if(u.push(o),oi({sortable:w,rootEl:v,name:"select",targetEl:o,originalEvent:l}),l.shiftKey&&yi&&w.el.contains(yi)){if(e=a(yi),h=a(o),~e&&~h&&e!==h)for(h>e?(t=e,d=h):(t=h,d=e+1);t<d;t++)~u.indexOf(i[t])||(c(i[t],f.selectedClass,!0),u.push(i[t]),oi({sortable:w,rootEl:v,name:"select",targetEl:i[t],originalEvent:l}))}else yi=o;et=y}ii&&this.isMultiDrag&&(g=!1,(r[p].options.sort||r!==v)&&u.length>1&&(nt=s(o),b=a(o,":not(."+this.options.selectedClass+")"),!pi&&f.animation&&(o.thisAnimationDuration=null),y.captureAnimationState(),pi||(f.animation&&(o.fromRect=nt,u.forEach(function(n){if(n.thisAnimationDuration=null,n!==o){var t=g?s(n):nt;n.fromRect=t;y.addAnimationState({target:n,rect:t})}})),yr(),u.forEach(function(n){i[b]?r.insertBefore(n,i[b]):r.appendChild(n);b++}),ut===a(o)&&(it=!1,u.forEach(function(n){if(n.sortableIndex!==a(n)){it=!0;return}}),it&&(rt("update"),rt("sort")))),u.forEach(function(n){dr(n)}),y.animateAll()),et=y);(v===r||k&&k.lastPutMode!=="clone")&&tt.forEach(function(n){n.parentNode&&n.parentNode.removeChild(n)})}},nullingGlobal:function(){this.isMultiDrag=ii=!1;tt.length=0},destroyGlobal:function(){this._deselectMultiDrag();f(document,"pointerup",this._deselectMultiDrag);f(document,"mouseup",this._deselectMultiDrag);f(document,"touchend",this._deselectMultiDrag);f(document,"keydown",this._checkKeyDown);f(document,"keyup",this._checkKeyUp)},_deselectMultiDrag:function(n){if((typeof ii=="undefined"||!ii)&&et===this.sortable&&(!n||!rt(n.target,this.options.draggable,this.sortable.el,!1))&&(!n||n.button===0))while(u.length){var t=u[0];c(t,this.options.selectedClass,!1);u.shift();oi({sortable:this.sortable,rootEl:this.sortable.el,name:"deselect",targetEl:t,originalEvent:n})}},_checkKeyDown:function(n){n.key===this.options.multiDragKey&&(this.multiDragKeyDown=!0)},_checkKeyUp:function(n){n.key===this.options.multiDragKey&&(this.multiDragKeyDown=!1)}},it(n,{pluginName:"multiDrag",utils:{select:function(n){var t=n.parentNode[p];t&&t.options.multiDrag&&!~u.indexOf(n)&&(et&&et!==t&&(et.multiDrag._deselectMultiDrag(),et=t),c(n,t.options.selectedClass,!0),u.push(n))},deselect:function(n){var t=n.parentNode[p],i=u.indexOf(n);t&&t.options.multiDrag&&~i&&(c(n,t.options.selectedClass,!1),u.splice(i,1))}},eventProperties:function(){var i=this,n=[],t=[];return u.forEach(function(r){n.push({multiDragElement:r,index:r.sortableIndex});var u;u=g&&r!==o?-1:g?a(r,":not(."+i.options.selectedClass+")"):a(r);t.push({multiDragElement:r,index:u})}),{items:gf(u),clones:[].concat(tt),oldIndicies:n,newIndicies:t}},optionListeners:{multiDragKey:function(n){return n=n.toLowerCase(),n==="ctrl"?n="Control":n.length>1&&(n=n.charAt(0).toUpperCase()+n.substr(1)),n}}})}function fo(n,t){u.forEach(function(i,r){var u=t.children[i.sortableIndex+(n?Number(r):0)];u?t.insertBefore(i,u):t.appendChild(i)})}function wf(n,t){tt.forEach(function(i,r){var u=t.children[i.sortableIndex+(n?Number(r):0)];u?t.insertBefore(i,u):t.appendChild(i)})}function yr(){u.forEach(function(n){n!==o&&n.parentNode&&n.parentNode.removeChild(n)})}var ct=ht(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),ri=ht(/Edge/i),vu=ht(/firefox/i),ui=ht(/safari/i)&&!ht(/chrome/i)&&!ht(/android/i),yu=ht(/iP(ad|od|hone)/i),pu=ht(/chrome/i)&&ht(/android/i),wu={capture:!1,passive:!1},ku=/\s+/g,fi,p="Sortable"+(new Date).getTime(),dt=[],gr={initializeByDefault:!0},ei={mount:function(n){for(var t in gr)!gr.hasOwnProperty(t)||t in n||(n[t]=gr[t]);dt.forEach(function(t){if(t.pluginName===n.pluginName)throw"Sortable: Cannot mount plugin ".concat(n.pluginName," more than once");});dt.push(n)},pluginEvent:function(n,t,i){var u=this,r;this.eventCanceled=!1;i.cancel=function(){u.eventCanceled=!0};r=n+"Global";dt.forEach(function(u){t[u.pluginName]&&(t[u.pluginName][r]&&t[u.pluginName][r](ot({sortable:t},i)),t.options[u.pluginName]&&t[u.pluginName][n]&&t[u.pluginName][n](ot({sortable:t},i)))})},initializePlugins:function(n,t,i){var r,u;dt.forEach(function(r){var f=r.pluginName,u;(n.options[f]||r.initializeByDefault)&&(u=new r(n,t,n.options),u.sortable=n,u.options=n.options,n[f]=u,it(i,u.defaults))});for(r in n.options)n.options.hasOwnProperty(r)&&(u=this.modifyOption(n,r,n.options[r]),typeof u!="undefined"&&(n.options[r]=u))},getEventProperties:function(n,t){var i={};return dt.forEach(function(r){typeof r.eventProperties=="function"&&it(i,r.eventProperties.call(t[r.pluginName],n))}),i},modifyOption:function(n,t,i){var r;return dt.forEach(function(u){n[u.pluginName]&&u.optionListeners&&typeof u.optionListeners[t]=="function"&&(r=u.optionListeners[t].call(n[u.pluginName],i))}),r}},ce=["evt"],d=function(t,u){var f=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},e=f.evt,o=df(f,ce);ei.pluginEvent.bind(i)(t,u,ot({dragEl:n,parentEl:v,ghostEl:r,rootEl:h,nextEl:wt,lastDownEl:di,cloneEl:l,cloneHidden:at,dragStarted:hi,putSortable:w,activeSortable:i.active,originalEvent:e,oldIndex:gt,oldDraggableIndex:si,newIndex:nt,newDraggableIndex:vt,hideGhostForTarget:af,unhideGhostForTarget:vf,cloneNowHidden:function(){at=!0},cloneNowShown:function(){at=!1},dispatchSortableEvent:function(n){k({sortable:u,name:n,originalEvent:e})}},o))},n,v,r,h,wt,di,l,at,gt,nt,si,vt,gi,w,ni=!1,nr=!1,tr=[],bt,ft,nu,tu,ef,of,hi,ti,ci,li=!1,ir=!1,rr,b,iu=[],ru=!1,ur=[],fr=typeof document!="undefined",er=yu,sf=ri||ct?"cssFloat":"float",le=fr&&!pu&&!yu&&"draggable"in document.createElement("div"),hf=function(){if(fr){if(ct)return!1;var n=document.createElement("x");return n.style.cssText="pointer-events:auto",n.style.pointerEvents==="auto"}}(),cf=function(n,i){var r=t(n),h=parseInt(r.width)-parseInt(r.paddingLeft)-parseInt(r.paddingRight)-parseInt(r.borderLeftWidth)-parseInt(r.borderRightWidth),f=kt(n,0,i),e=kt(n,1,i),u=f&&t(f),o=e&&t(e),c=u&&parseInt(u.marginLeft)+parseInt(u.marginRight)+s(f).width,a=o&&parseInt(o.marginLeft)+parseInt(o.marginRight)+s(e).width,l;return r.display==="flex"?r.flexDirection==="column"||r.flexDirection==="column-reverse"?"vertical":"horizontal":r.display==="grid"?r.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal":f&&u.float&&u.float!=="none"?(l=u.float==="left"?"left":"right",e&&(o.clear==="both"||o.clear===l)?"vertical":"horizontal"):f&&(u.display==="block"||u.display==="flex"||u.display==="table"||u.display==="grid"||c>=h&&r[sf]==="none"||e&&r[sf]==="none"&&c+a>h)?"vertical":"horizontal"},ae=function(n,t,i){var r=i?n.left:n.top,f=i?n.right:n.bottom,e=i?n.width:n.height,u=i?t.left:t.top,o=i?t.right:t.bottom,s=i?t.width:t.height;return r===u||f===o||r+e/2===u+s/2},ve=function(n,t){var i;return tr.some(function(r){var u=r[p].options.emptyInsertThreshold;if(u&&!wr(r)){var f=s(r),e=n>=f.left-u&&n<=f.right+u,o=t>=f.top-u&&t<=f.bottom+u;if(e&&o)return i=r}}),i},lf=function(n){function r(n,t){return function(i,u,f,e){var s=i.options.group.name&&u.options.group.name&&i.options.group.name===u.options.group.name,o;return n==null&&(t||s)?!0:n==null||n===!1?!1:t&&n==="clone"?n:typeof n=="function"?r(n(i,u,f,e),t)(i,u,f,e):(o=(t?i:u).options.group.name,n===!0||typeof n=="string"&&n===o||n.join&&n.indexOf(o)>-1)}}var i={},t=n.group;t&&bi(t)=="object"||(t={name:t});i.name=t.name;i.checkPull=r(t.pull,!0);i.checkPut=r(t.put);i.revertClone=t.revertClone;n.group=i},af=function(){!hf&&r&&t(r,"display","none")},vf=function(){!hf&&r&&t(r,"display","")},yt,yf,y,ai,eu,hr,ou,su,cr,vi,ar,hu,ut;fr&&!pu&&document.addEventListener("click",function(n){if(nr)return n.preventDefault(),n.stopPropagation&&n.stopPropagation(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),nr=!1,!1},!0);yt=function(t){var r,i,u;if(n&&(t=t.touches?t.touches[0]:t,r=ve(t.clientX,t.clientY),r)){i={};for(u in t)t.hasOwnProperty(u)&&(i[u]=t[u]);i.target=i.rootEl=r;i.preventDefault=void 0;i.stopPropagation=void 0;r[p]._onDragOver(i)}};yf=function(t){n&&n.parentNode[p]._isOutsideThisEl(t.target)};i.prototype={constructor:i,_isOutsideThisEl:function(n){this.el.contains(n)||n===this.el||(ti=null)},_getDirection:function(t,i){return typeof this.options.direction=="function"?this.options.direction.call(this,t,i,n):this.options.direction},_onTapStart:function(t){if(t.cancelable){var e=this,r=this.el,u=this.options,s=u.preventOnFilter,c=t.type,h=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,i=(h||t).target,o=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||i,f=u.filter;if((no(r),!n)&&(!/mousedown|pointerdown/.test(c)||t.button===0)&&!u.disabled&&!o.isContentEditable&&(this.nativeDraggable||!ui||!i||i.tagName.toUpperCase()!=="SELECT")&&(i=rt(i,u.draggable,r,!1),!i||!i.animated)&&di!==i){if(gt=a(i),si=a(i,u.draggable),typeof f=="function"){if(f.call(this,t,i,this)){k({sortable:e,rootEl:o,name:"filter",targetEl:i,toEl:r,fromEl:r});d("filter",e,{evt:t});s&&t.cancelable&&t.preventDefault();return}}else if(f&&(f=f.split(",").some(function(n){return n=rt(o,n.trim(),r,!1),n?(k({sortable:e,rootEl:n,name:"filter",targetEl:i,fromEl:r,toEl:r}),d("filter",e,{evt:t}),!0):void 0}),f)){s&&t.cancelable&&t.preventDefault();return}(!u.handle||rt(o,u.handle,r,!1))&&this._prepareDragStart(t,h,i)}}},_prepareDragStart:function(t,r,u){var f=this,a=f.el,l=f.options,o=a.ownerDocument,y,p;if(u&&!n&&u.parentNode===a)if(p=s(u),h=a,n=u,v=n.parentNode,wt=n.nextSibling,di=u,gi=l.group,i.dragged=n,bt={target:n,clientX:(r||t).clientX,clientY:(r||t).clientY},ef=bt.clientX-p.left,of=bt.clientY-p.top,this._lastX=(r||t).clientX,this._lastY=(r||t).clientY,n.style["will-change"]="all",y=function(){if(d("delayEnded",f,{evt:t}),i.eventCanceled){f._onDrop();return}f._disableDelayedDragEvents();!vu&&f.nativeDraggable&&(n.draggable=!0);f._triggerDragStart(t,r);k({sortable:f,name:"choose",originalEvent:t});c(n,l.chosenClass,!0)},l.ignore.split(",").forEach(function(t){du(n,t.trim(),uu)}),e(o,"dragover",yt),e(o,"mousemove",yt),e(o,"touchmove",yt),e(o,"mouseup",f._onDrop),e(o,"touchend",f._onDrop),e(o,"touchcancel",f._onDrop),vu&&this.nativeDraggable&&(this.options.touchStartThreshold=4,n.draggable=!0),d("delayStart",this,{evt:t}),!l.delay||l.delayOnTouchOnly&&!r||this.nativeDraggable&&(ri||ct))y();else{if(i.eventCanceled){this._onDrop();return}e(o,"mouseup",f._disableDelayedDrag);e(o,"touchend",f._disableDelayedDrag);e(o,"touchcancel",f._disableDelayedDrag);e(o,"mousemove",f._delayedDragTouchMoveHandler);e(o,"touchmove",f._delayedDragTouchMoveHandler);l.supportPointer&&e(o,"pointermove",f._delayedDragTouchMoveHandler);f._dragStartTimer=setTimeout(y,l.delay)}},_delayedDragTouchMoveHandler:function(n){var t=n.touches?n.touches[0]:n;Math.max(Math.abs(t.clientX-this._lastX),Math.abs(t.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){n&&uu(n);clearTimeout(this._dragStartTimer);this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var n=this.el.ownerDocument;f(n,"mouseup",this._disableDelayedDrag);f(n,"touchend",this._disableDelayedDrag);f(n,"touchcancel",this._disableDelayedDrag);f(n,"mousemove",this._delayedDragTouchMoveHandler);f(n,"touchmove",this._delayedDragTouchMoveHandler);f(n,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,i){i=i||t.pointerType=="touch"&&t;!this.nativeDraggable||i?this.options.supportPointer?e(document,"pointermove",this._onTouchMove):i?e(document,"touchmove",this._onTouchMove):e(document,"mousemove",this._onTouchMove):(e(n,"dragend",this),e(h,"dragstart",this._onDragStart));try{document.selection?sr(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch(r){}},_dragStarted:function(t,r){if(ni=!1,h&&n){d("dragStarted",this,{evt:r});this.nativeDraggable&&e(document,"dragover",yf);var u=this.options;t||c(n,u.dragClass,!1);c(n,u.ghostClass,!0);i.active=this;t&&this._appendGhost();k({sortable:this,name:"start",originalEvent:r})}else this._nulling()},_emulateDragOver:function(){var t,i,r;if(ft){for(this._lastX=ft.clientX,this._lastY=ft.clientY,af(),t=document.elementFromPoint(ft.clientX,ft.clientY),i=t;t&&t.shadowRoot;){if(t=t.shadowRoot.elementFromPoint(ft.clientX,ft.clientY),t===i)break;i=t}if(n.parentNode[p]._isOutsideThisEl(t),i)do{if(i[p]&&(r=void 0,r=i[p]._onDragOver({clientX:ft.clientX,clientY:ft.clientY,target:t,rootEl:i}),r&&!this.options.dragoverBubble))break;t=i}while(i=bu(i));vf()}},_onTouchMove:function(n){var e;if(bt){var c=this.options,l=c.fallbackTolerance,a=c.fallbackOffset,f=n.touches?n.touches[0]:n,u=r&&pt(r,!0),v=r&&u&&u.a,y=r&&u&&u.d,o=er&&b&&nf(b),s=(f.clientX-bt.clientX+a.x)/(v||1)+(o?o[0]-iu[0]:0)/(v||1),h=(f.clientY-bt.clientY+a.y)/(y||1)+(o?o[1]-iu[1]:0)/(y||1);if(!i.active&&!ni){if(l&&Math.max(Math.abs(f.clientX-this._lastX),Math.abs(f.clientY-this._lastY))<l)return;this._onDragStart(n,!0)}r&&(u?(u.e+=s-(nu||0),u.f+=h-(tu||0)):u={a:1,b:0,c:0,d:1,e:s,f:h},e="matrix(".concat(u.a,",").concat(u.b,",").concat(u.c,",").concat(u.d,",").concat(u.e,",").concat(u.f,")"),t(r,"webkitTransform",e),t(r,"mozTransform",e),t(r,"msTransform",e),t(r,"transform",e),nu=s,tu=h,ft=f);n.cancelable&&n.preventDefault()}},_appendGhost:function(){if(!r){var f=this.options.fallbackOnBody?document.body:h,u=s(n,!0,er,!0,f),e=this.options;if(er){for(b=f;t(b,"position")==="static"&&t(b,"transform")==="none"&&b!==document;)b=b.parentNode;b!==document.body&&b!==document.documentElement?(b===document&&(b=st()),u.top+=b.scrollTop,u.left+=b.scrollLeft):b=st();iu=nf(b)}r=n.cloneNode(!0);c(r,e.ghostClass,!1);c(r,e.fallbackClass,!0);c(r,e.dragClass,!0);t(r,"transition","");t(r,"transform","");t(r,"box-sizing","border-box");t(r,"margin",0);t(r,"top",u.top);t(r,"left",u.left);t(r,"width",u.width);t(r,"height",u.height);t(r,"opacity","0.8");t(r,"position",er?"absolute":"fixed");t(r,"zIndex","100000");t(r,"pointerEvents","none");i.ghost=r;f.appendChild(r);t(r,"transform-origin",ef/parseInt(r.style.width)*100+"% "+of/parseInt(r.style.height)*100+"%")}},_onDragStart:function(r,u){var o=this,s=r.dataTransfer,a=o.options;if(d("dragStart",this,{evt:r}),i.eventCanceled){this._onDrop();return}d("setupClone",this);i.eventCanceled||(l=kr(n),l.removeAttribute("id"),l.draggable=!1,l.style["will-change"]="",this._hideClone(),c(l,this.options.chosenClass,!1),i.clone=l);o.cloneId=sr(function(){(d("clone",o),i.eventCanceled)||(o.options.removeCloneOnHide||h.insertBefore(l,n),o._hideClone(),k({sortable:o,name:"clone"}))});u||c(n,a.dragClass,!0);u?(nr=!0,o._loopId=setInterval(o._emulateDragOver,50)):(f(document,"mouseup",o._onDrop),f(document,"touchend",o._onDrop),f(document,"touchcancel",o._onDrop),s&&(s.effectAllowed="move",a.setData&&a.setData.call(o,s,n)),e(document,"drop",o),t(n,"transform","translateZ(0)"));ni=!0;o._dragStartId=sr(o._dragStarted.bind(o,u,r));e(document,"selectstart",o);hi=!0;ui&&t(document.body,"user-select","none")},_onDragOver:function(u){function et(t,i){d(t,o,ot({evt:u,isOwner:ni,axis:ft?"vertical":"horizontal",revert:gt,dragRect:it,targetRect:y,canSort:oi,fromSortable:tt,target:f,completed:b,onMove:function(t,i){return or(h,e,n,it,t,s(t),u,i)},changed:bt},i))}function pt(){et("dragOverAnimationCapture");o.captureAnimationState();o!==tt&&tt.captureAnimationState()}function b(t){return et("dragOverCompleted",{insertion:t}),t&&(ni?ut._hideClone():ut._showClone(o),o!==tt&&(c(n,w?w.options.ghostClass:ut.options.ghostClass,!1),c(n,l.ghostClass,!0)),w!==o&&o!==i.active?w=o:o===i.active&&w&&(w=null),tt===o&&(o._ignoreWhileAnimating=f),o.animateAll(function(){et("dragOverAnimationComplete");o._ignoreWhileAnimating=null}),o!==tt&&(tt.animateAll(),tt._ignoreWhileAnimating=null)),(f!==n||n.animated)&&(f!==e||f.animated)||(ti=null),l.dragoverBubble||u.rootEl||f===document||(n.parentNode[p]._isOutsideThisEl(u.target),t||yt(u)),!l.dragoverBubble&&u.stopPropagation&&u.stopPropagation(),ii=!0}function bt(){nt=a(n);vt=a(n,l.draggable);k({sortable:o,name:"change",toEl:e,newIndex:nt,newDraggableIndex:vt,originalEvent:u})}var e=this.el,f=u.target,it,y,gt,l=this.options,ei=l.group,ut=i.active,ni=gi===ei,oi=l.sort,tt=w||ut,ft,o=this,ii=!1,g,dt,lt,ui,fi,ht,at;if(!ru){if(u.preventDefault!==void 0&&u.cancelable&&u.preventDefault(),f=rt(f,l.draggable,e,!0),et("dragOver"),i.eventCanceled)return ii;if(n.contains(u.target)||f.animated&&f.animatingX&&f.animatingY||o._ignoreWhileAnimating===f)return b(!1);if(nr=!1,ut&&!l.disabled&&(ni?oi||(gt=v!==h):w===this||(this.lastPutMode=gi.checkPull(this,ut,n,u))&&ei.checkPut(this,ut,n,u))){if(ft=this._getDirection(u,f)==="vertical",it=s(n),et("dragOverValid"),i.eventCanceled)return ii;if(gt)return v=h,pt(),this._hideClone(),et("revert"),i.eventCanceled||(wt?h.insertBefore(n,wt):h.appendChild(n)),b(!0);if(g=wr(e,l.draggable),g&&(!be(u,ft,this)||g.animated)){if(g&&we(u,ft,this)){if(dt=kt(e,0,l,!0),dt===n)return b(!1);if(f=dt,y=s(f),or(h,e,n,it,f,y,u,!1)!==!1)return pt(),e.insertBefore(n,dt),v=e,bt(),b(!0)}else if(f.parentNode===e){y=s(f);var st=0,ri,ai=n.parentNode!==e,si=!ae(n.animated&&n.toRect||it,f.animated&&f.toRect||y,ft),hi=ft?"top":"left",ct=gu(f,"top","top")||gu(n,"top","top"),vi=ct?ct.scrollTop:void 0;if(ti!==f&&(ri=y[hi],li=!1,ir=!si&&l.invertSwap||ai),st=ke(u,f,y,ft,si?1:l.swapThreshold,l.invertedSwapThreshold==null?l.swapThreshold:l.invertedSwapThreshold,ir,ti===f),st!==0){ui=a(n);do ui-=st,lt=v.children[ui];while(lt&&(t(lt,"display")==="none"||lt===r))}if(st===0||lt===f)return b(!1);if(ti=f,ci=st,fi=f.nextElementSibling,ht=!1,ht=st===1,at=or(h,e,n,it,f,y,u,ht),at!==!1)return(at===1||at===-1)&&(ht=at===1),ru=!0,setTimeout(pe,30),pt(),ht&&!fi?e.appendChild(n):f.parentNode.insertBefore(n,ht?fi:f),ct&&rf(ct,0,vi-ct.scrollTop),v=n.parentNode,ri===undefined||ir||(rr=Math.abs(ri-s(f)[hi])),bt(),b(!0)}}else{if(g===n)return b(!1);if(g&&e===u.target&&(f=g),f&&(y=s(f)),or(h,e,n,it,f,y,u,!!f)!==!1)return pt(),g&&g.nextSibling?e.insertBefore(n,g.nextSibling):e.appendChild(n),v=e,bt(),b(!0)}if(e.contains(n))return b(!1)}return!1}},_ignoreWhileAnimating:null,_offMoveEvents:function(){f(document,"mousemove",this._onTouchMove);f(document,"touchmove",this._onTouchMove);f(document,"pointermove",this._onTouchMove);f(document,"dragover",yt);f(document,"mousemove",yt);f(document,"touchmove",yt)},_offUpEvents:function(){var n=this.el.ownerDocument;f(n,"mouseup",this._onDrop);f(n,"touchend",this._onDrop);f(n,"pointerup",this._onDrop);f(n,"touchcancel",this._onDrop);f(document,"selectstart",this)},_onDrop:function(u){var o=this.el,e=this.options;if(nt=a(n),vt=a(n,e.draggable),d("drop",this,{evt:u}),v=n&&n.parentNode,nt=a(n),vt=a(n,e.draggable),i.eventCanceled){this._nulling();return}ni=!1;ir=!1;li=!1;clearInterval(this._loopId);clearTimeout(this._dragStartTimer);fu(this.cloneId);fu(this._dragStartId);this.nativeDraggable&&(f(document,"drop",this),f(o,"dragstart",this._onDragStart));this._offMoveEvents();this._offUpEvents();ui&&t(document.body,"user-select","");t(n,"transform","");u&&(hi&&(u.cancelable&&u.preventDefault(),e.dropBubble||u.stopPropagation()),r&&r.parentNode&&r.parentNode.removeChild(r),(h===v||w&&w.lastPutMode!=="clone")&&l&&l.parentNode&&l.parentNode.removeChild(l),n&&(this.nativeDraggable&&f(n,"dragend",this),uu(n),n.style["will-change"]="",hi&&!ni&&c(n,w?w.options.ghostClass:this.options.ghostClass,!1),c(n,this.options.chosenClass,!1),k({sortable:this,name:"unchoose",toEl:v,newIndex:null,newDraggableIndex:null,originalEvent:u}),h!==v?(nt>=0&&(k({rootEl:v,name:"add",toEl:v,fromEl:h,originalEvent:u}),k({sortable:this,name:"remove",toEl:v,originalEvent:u}),k({rootEl:v,name:"sort",toEl:v,fromEl:h,originalEvent:u}),k({sortable:this,name:"sort",toEl:v,originalEvent:u})),w&&w.save()):nt!==gt&&nt>=0&&(k({sortable:this,name:"update",toEl:v,originalEvent:u}),k({sortable:this,name:"sort",toEl:v,originalEvent:u})),i.active&&((nt==null||nt===-1)&&(nt=gt,vt=si),k({sortable:this,name:"end",toEl:v,originalEvent:u}),this.save())));this._nulling()},_nulling:function(){d("nulling",this);h=n=v=r=wt=l=di=at=bt=ft=hi=nt=vt=gt=si=ti=ci=w=gi=i.dragged=i.ghost=i.clone=i.active=null;ur.forEach(function(n){n.checked=!0});ur.length=nu=tu=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":n&&(this._onDragOver(t),ye(t));break;case"selectstart":t.preventDefault()}},toArray:function(){for(var i=[],n,r=this.el.children,t=0,f=r.length,u=this.options;t<f;t++)n=r[t],rt(n,u.draggable,this.el,!1)&&i.push(n.getAttribute(u.dataIdAttr)||ge(n));return i},sort:function(n,t){var i={},r=this.el;this.toArray().forEach(function(n,t){var u=r.children[t];rt(u,this.options.draggable,r,!1)&&(i[n]=u)},this);t&&this.captureAnimationState();n.forEach(function(n){i[n]&&(r.removeChild(i[n]),r.appendChild(i[n]))});t&&this.animateAll()},save:function(){var n=this.options.store;n&&n.set&&n.set(this)},closest:function(n,t){return rt(n,t||this.options.draggable,this.el,!1)},option:function(n,t){var i=this.options,r;if(t===void 0)return i[n];r=ei.modifyOption(this,n,t);i[n]=typeof r!="undefined"?r:t;n==="group"&&lf(i)},destroy:function(){d("destroy",this);var n=this.el;n[p]=null;f(n,"mousedown",this._onTapStart);f(n,"touchstart",this._onTapStart);f(n,"pointerdown",this._onTapStart);this.nativeDraggable&&(f(n,"dragover",this),f(n,"dragenter",this));Array.prototype.forEach.call(n.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")});this._onDrop();this._disableDelayedDragEvents();tr.splice(tr.indexOf(this.el),1);this.el=n=null},_hideClone:function(){if(!at){if(d("hideClone",this),i.eventCanceled)return;t(l,"display","none");this.options.removeCloneOnHide&&l.parentNode&&l.parentNode.removeChild(l);at=!0}},_showClone:function(r){if(r.lastPutMode!=="clone"){this._hideClone();return}if(at){if(d("showClone",this),i.eventCanceled)return;n.parentNode!=h||this.options.group.revertClone?wt?h.insertBefore(l,wt):h.appendChild(l):h.insertBefore(l,n);this.options.group.revertClone&&this.animate(n,l);t(l,"display","");at=!1}}};fr&&e(document,"touchmove",function(n){(i.active||ni)&&n.cancelable&&n.preventDefault()});i.utils={on:e,off:f,css:t,find:du,is:function(n,t){return!!rt(n,t,n,!1)},extend:fe,throttle:tf,closest:rt,toggleClass:c,clone:kr,index:a,nextTick:sr,cancelNextTick:fu,detectDirection:cf,getChild:kt,expando:p};i.get=function(n){return n[p]};i.mount=function(){for(var r=arguments.length,n=new Array(r),t=0;t<r;t++)n[t]=arguments[t];n[0].constructor===Array&&(n=n[0]);n.forEach(function(n){if(!n.prototype||!n.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(n));n.utils&&(i.utils=ot(ot({},i.utils),n.utils));ei.mount(n)})};i.create=function(n,t){return new i(n,t)};i.version="1.15.3";y=[];hr=!1;ar=tf(function(n,r,u,f){var e,l,w,b,a;if(r.scroll){var ut=(n.touches?n.touches[0]:n).clientX,ft=(n.touches?n.touches[0]:n).clientY,v=r.scrollSensitivity,et=r.scrollSpeed,ot=st(),ht=!1,k;eu!==u&&(eu=u,lr(),ai=r.scroll,k=r.scrollFn,ai===!0&&(ai=lt(u,!0)));e=0;l=ai;do{var h=l,c=s(h),vt=c.top,yt=c.bottom,pt=c.left,wt=c.right,d=c.width,g=c.height,nt=void 0,tt=void 0,it=h.scrollWidth,rt=h.scrollHeight,o=t(h),ct=h.scrollLeft,at=h.scrollTop;if(h===ot?(nt=d<it&&(o.overflowX==="auto"||o.overflowX==="scroll"||o.overflowX==="visible"),tt=g<rt&&(o.overflowY==="auto"||o.overflowY==="scroll"||o.overflowY==="visible")):(nt=d<it&&(o.overflowX==="auto"||o.overflowX==="scroll"),tt=g<rt&&(o.overflowY==="auto"||o.overflowY==="scroll")),w=nt&&(Math.abs(wt-ut)<=v&&ct+d<it)-(Math.abs(pt-ut)<=v&&!!ct),b=tt&&(Math.abs(yt-ft)<=v&&at+g<rt)-(Math.abs(vt-ft)<=v&&!!at),!y[e])for(a=0;a<=e;a++)y[a]||(y[a]={});(y[e].vx!=w||y[e].vy!=b||y[e].el!==h)&&(y[e].el=h,y[e].vx=w,y[e].vy=b,clearInterval(y[e].pid),(w!=0||b!=0)&&(ht=!0,y[e].pid=setInterval(function(){f&&this.layer===0&&i.active._onTouchMove(cr);var t=y[this.layer].vy?y[this.layer].vy*et:0,r=y[this.layer].vx?y[this.layer].vx*et:0;(typeof k!="function"||k.call(i.dragged.parentNode[p],r,t,n,cr,y[this.layer].el)==="continue")&&rf(y[this.layer].el,r,t)}.bind({layer:e}),24)));e++}while(r.bubbleScroll&&l!==ot&&(l=lt(l,!1)));hr=ht}},30);hu=function(n){var t=n.originalEvent,u=n.putSortable,e=n.dragEl,o=n.activeSortable,s=n.dispatchSortableEvent,h=n.hideGhostForTarget,c=n.unhideGhostForTarget,i,r,f;if(t&&(i=u||o,h(),r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,f=document.elementFromPoint(r.clientX,r.clientY),c(),i&&!i.el.contains(f))){s("spill");this.onSpill({dragEl:e,putSortable:u})}};cu.prototype={startIndex:null,dragStart:function(n){var t=n.oldDraggableIndex;this.startIndex=t},onSpill:function(n){var r=n.dragEl,t=n.putSortable,i;this.sortable.captureAnimationState();t&&t.captureAnimationState();i=kt(this.sortable.el,this.startIndex,this.options);i?this.sortable.el.insertBefore(r,i):this.sortable.el.appendChild(r);this.sortable.animateAll();t&&t.animateAll()},drop:hu};it(cu,{pluginName:"revertOnSpill"});lu.prototype={onSpill:function(n){var t=n.dragEl,r=n.putSortable,i=r||this.sortable;i.captureAnimationState();t.parentNode&&t.parentNode.removeChild(t);i.animateAll()},drop:hu};it(lu,{pluginName:"removeOnSpill"});var u=[],tt=[],yi,et,pi=!1,g=!1,ii=!1,o,wi,vr;return i.mount(new to),i.mount(lu,cu),i.mount(new io),i.mount(new uo),i});var prefix=window.location.origin.includes("local")?"":"https://thecabinet20230725181154.azurewebsites.net",dbUrl=prefix+"/api/Songs",pageName=getPageName(),showUnfinishedSongs=localStorage.getItem("showUnfinishedSongs")=="true",currentMenu;language="Spanish";var songData=JSON.parse(sessionStorage.getItem("songData")),setListData=JSON.parse(localStorage.getItem("setListData")),originalSongText,originalKey,originalUseFlats,originalUseSolfege,prefix=window.location.origin.includes("local")?"":"https://thecabinet20230725181154.azurewebsites.net",mainUrl=prefix+"/api/ChordChart",updateCabinetURL=prefix+"/api/UpdateCabinet",displayingChords=!0,resizeId,fontStyle="Arial",displayType=localStorage.getItem("displayType"),sortable,displayingIndividualSong=!0,pagesContainer=get("mainContent"),centerSection=get("contentContainer");document.addEventListener("DOMContentLoaded",function(){var i;onDomLoad();let u=new URLSearchParams(window.location.search).get("display");!u||(displayType=u);displayType!="Chords"&&displayType!="Complete"&&displayType!="Lyrics"&&(displayType="Chords");get("show"+displayType+"Button").classList.add("currentDisplayType");!localStorage.getItem("useCalibri")||(fontStyle="Calibri",pagesContainer.style.fontFamily="Calibri");!localStorage.getItem("chordColor2")||(get("chordColor1Button").classList.remove("selected"),get("chordColor2Button").classList.add("selected"),pagesContainer.classList.add("chordColor2"));let f=new URLSearchParams(window.location.search).get("songs");if(!!f){displayingIndividualSong=!1;loadNewSetListData(f,new URLSearchParams(window.location.search).get("setName"));replaceUrlWithSetList();return}let n=new URLSearchParams(window.location.search).get("set_list"),t=new URLSearchParams(window.location.search).get("song_id");if(!n||!t||(i=window.location.href.split("?")[0]+"?set_list="+n,history.replaceState(null,"",i)),!!n&&n!="local"){if(displayingIndividualSong=!1,!setListData||!setListData.setId||setListData.setId!=n){loadNewSavedSetList(n,t);return}if(!t)if(songData){let n=!1;for(let t=0;t<setListData.songs.length;t++)if(setListData.songs[t].id==songData.id){setListData.songs[t]=songData;n=!0;break}n||(songData=setListData.songs[0])}else songData=setListData.songs[0];else for(let n=0;n<setListData.songs.length;n++)if(setListData.songs[n].id==t){songData=setListData.songs[n];saveCurrentSongData();break}checkForSavedSetUpdates();return}if(n!="local"||setListData||goHome(),!!setListData&&(setUpCurrentSetListMetadata(),n=="local")){for(let n=0;n<setListData.songs.length;n++)if(setListData.songs[n].id==songData.id){setListData.songs[n]=songData;break}displayingIndividualSong=!1;displayNewSong();return}let r=new URLSearchParams(window.location.search).get("song");if(!!r){loadNewSong(r);i=window.location.href.split("?")[0]+"?song_id="+r.split("-")[0];history.replaceState(null,"",i);return}t||goHome();songData&&songData.id==t?(displayNewSong(),sessionStorage.removeItem("addingASong")):loadNewSong(t)});window.addEventListener("load",function(){async function t(n){let t=await n.json();setListData.lastUpdate=JSON.stringify(t);saveSetListData();removeChildren(get("setListSongs"));setUpCurrentSetListMetadata()}function i(n){let t=n.dataset.song;if(t!=songData.id)for(let n=0;n<setListData.songs.length;n++)if(setListData.songs[n].id==t){saveAndDisplayNewSetListSongMetadata(setListData.songs[n]);return}}function r(n){if(!displayingIndividualSong&&setListData&&!sizingASetList&&setListData.songs.length!=1){var t=n.target.scrollLeft%n.target.offsetWidth==0,r=t?0:150;clearTimeout(n.target.scrollTimeout);n.target.scrollTimeout=setTimeout(function(){var t=Math.round(n.target.scrollLeft/n.target.offsetWidth);i(n.target.children[t])},r)}}function u(n,t,i){if(i>=n.length)for(var r=i-n.length+1;r--;)n.push(undefined);n.splice(i,0,n.splice(t,1)[0])}setupSharedEvents();setupGestures();get("settingsMenuButton").addEventListener("click",function(){currentMenu="Settings";get("settingsMenu").classList.remove("hidden");get("chordsMenu").classList.add("hidden");centerSection.scrollIntoView({inline:"start",block:"start"});seamless.scrollIntoView(get("settingsMenu"),{behavior:"smooth",block:"start",inline:"start"},{duration:350});centerSection.classList.add("dark");checkUpdatePrintButtons()});get("createASetListButton").addEventListener("click",createSetList);get("addCurrentSongButton").addEventListener("click",addCurrentSongToSetList);get("addNewSongToSetListButton").addEventListener("click",addNewSongToSetList);get("createASetListButton").addEventListener("click",createSetList);get("editSetListSongButton").addEventListener("click",editSetList);get("unlockSetListSongButton").addEventListener("click",unlockSetlist);get("deleteSetListButton").addEventListener("click",deleteSetList);get("shareSetListButton").addEventListener("click",function(){if(setListData){let n=window.location.href.split("?")[0]+"?"+(!!displayType&&displayType!="Chords"?"display="+displayType+"&":"")+"songs="+setListData.songs[0].idWithFlags;for(let t=1;t<setListData.songs.length;t++)n+=","+setListData.songs[t].idWithFlags;setListData.setListName!="Set List"&&(n+="&setName="+encodeURIComponent(setListData.setListName));const t={title:(usingSpanish()?"Caja de Música - ":"Music Box - ")+setListData.setListName,url:n};navigator.share(t)}});get("saveSetListSongButton").addEventListener("click",function(){let n=setListData.setId?setListData.setId:"ICCM";if(confirm("Save to the '"+n+"' set list?")){setListData.setId||(setListData.setId=n,replaceUrlWithSetList());let i=setListData.songs[0].idWithFlags;for(let n=1;n<setListData.songs.length;n++)i+=","+setListData.songs[n].idWithFlags;fetch(updateCabinetURL+"/updateSetList",{method:"PATCH",body:JSON.stringify({setId:setListData.setId,setListName:setListData.setListName,songsString:i}),headers:{"Content-Type":"application/json",Authorization:"Bearer "+localStorage.getItem("token")}}).then(n=>{if(!n.ok){switch(n.status){case 401:runLogout();alert("Update failed: Login timed out");openLoginPopup();return;case 503:runLogout();alert("Update failed: Could not connect to the database");break;case 400:alert("Update failed: Invalid request");break;default:alert("Update failed")}return}t(n)})}});get("cancelSearchButton").addEventListener("click",function(){!sessionStorage.getItem("addingASong")||(sessionStorage.removeItem("addingASong"),get("settingsMenu").scrollIntoView({inline:"start",block:"start"}),centerSection.classList.add("dark"))});pagesContainer.addEventListener("scroll",r);get("confirmSetListChangesButton").addEventListener("click",confirmSetListChanges);get("cancelSetListChangesButton").addEventListener("click",cancelSetListChanges);sortable=new Sortable(get("setListSongs"),{group:"setList",animation:150,disabled:!0,onUpdate:function(n){setListData&&u(setListData.songs,n.oldDraggableIndex,n.newDraggableIndex)}});let n=!1;get("setListOptionsContainer").addEventListener("click",t=>{clickedOn(t,"setListOptions")||(n=!n,get("setListOptionsContainer").classList.toggle("open"))});document.addEventListener("click",t=>{!n||clickedOn(t,"setListOptionsContainer")||clickedOn(t,"setListOptions")||(n=!1,get("setListOptionsContainer").classList.remove("open"))});updateTranslatedPageLink();get("infoMenuButton").addEventListener("click",function(){currentMenu="Info";seamless.scrollIntoView(get("infoMenu"),{behavior:"smooth",block:"start",inline:"end"},{duration:350});centerSection.classList.add("dark");checkUpdatePrintButtons()});get("shareSongButton").addEventListener("click",function(){const n={title:(usingSpanish()?"Caja de Música - ":"Music Box - ")+songData.songName,url:window.location.href.split("?")[0]+"?"+(!!displayType&&displayType!="Chords"?"display="+displayType+"&":"")+"song="+songData.idWithFlags};navigator.share(n)});get("printButton").addEventListener("click",printSong);get("moreVersionsButton").addEventListener("click",loadSongVersions);setupSongEditing();get("chordsMenuButton").addEventListener("click",function(){currentMenu="Chords";get("settingsMenu").classList.add("hidden");get("chordsMenu").classList.remove("hidden");centerSection.scrollIntoView({inline:"start",block:"start"});seamless.scrollIntoView(get("chordsMenu"),{behavior:"smooth",inline:"start",block:"start"},{duration:350});centerSection.classList.add("dark")});get("showChordsButton").addEventListener("click",function(){setDisplayType("Chords")});get("showCompleteButton").addEventListener("click",function(){setDisplayType("Complete")});get("showLyricsButton").addEventListener("click",function(){setDisplayType("Lyrics")});get("originalKeyButton").addEventListener("click",function(){usingFlats=originalUseFlats;usingSolfege=originalUseSolfege;transposeTo(originalKey)});get("toSharpsButton").addEventListener("click",convertToSharps);get("toFlatsButton").addEventListener("click",convertToFlats);get("toLettersButton").addEventListener("click",convertToLetters);get("toSolfegeButton").addEventListener("click",convertToSolfege);get("chordColor1Button").addEventListener("click",function(){this.classList.contains("selected")||(get("chordColor2Button").classList.remove("selected"),this.classList.add("selected"),pagesContainer.classList.remove("chordColor2"),localStorage.removeItem("chordColor2"))});get("chordColor2Button").addEventListener("click",function(){this.classList.contains("selected")||(get("chordColor1Button").classList.remove("selected"),this.classList.add("selected"),pagesContainer.classList.add("chordColor2"),localStorage.setItem("chordColor2",!0))});get("toArialButton").addEventListener("click",function(){fontStyle!="Arial"&&(fontStyle="Arial",pagesContainer.style.fontFamily="Arial",localStorage.removeItem("useCalibri"),fitCurrentSong())});get("toCalibriButton").addEventListener("click",function(){fontStyle!="Calibri"&&(fontStyle="Calibri",pagesContainer.style.fontFamily="Calibri",localStorage.setItem("useCalibri",!0),fitCurrentSong())});window.addEventListener("resize",function(){clearTimeout(resizeId);resizeId=setTimeout(onResize,15)})});inFullscreen=!1;const MAX_SET_LIST_SONGS=20;editingSetList=!1;keyOptions=[["LA","SIb","SI","DO","REb","RE","MIb","MI","FA","SOLb","SOL","LAb"],["LA","LA#","SI","DO","DO#","RE","RE#","MI","FA","FA#","SOL","SOL#"],["A","Bb","B","C","Db","D","Eb","E","F","Gb","G","Ab"],["A","A#","B","C","C#","D","D#","E","F","F#","G","G#"]];usingFlats=!1;usingSolfege=!1;songWasChanged=!1;loadedInVersions=!1;var screenWidth,screenHeight,screenProportion,songElement,dontSplitSections,minSongScale=1.25,maxSongScale=2,dontSplitSongIfAlreadyAtScale=1.8,maxColumns=4,bonusToLessColumns=0,scaleDifferenceBetweenPages=.1;sizingASetList=!1;const sizingMarginForError=.05;editingTheSong=!1;var prefix=window.location.origin.includes("local")?"":"https://thecabinet20230725181154.azurewebsites.net",updateCabinetURL=prefix+"/api/UpdateCabinet",loginURL=prefix+"/api/Login";document.addEventListener("DOMContentLoaded",function(){testDatabaseEditorConnection()});window.addEventListener("load",function(){setupLoginEvents();get("showUnfinishedSongsCheckBox").checked=showUnfinishedSongs;get("showUnfinishedSongsToggle").addEventListener("click",function(){showUnfinishedSongs=!showUnfinishedSongs;limitToCurrentLanguage=!showUnfinishedSongs;get("showUnfinishedSongsCheckBox").checked=showUnfinishedSongs;localStorage.setItem("showUnfinishedSongs",showUnfinishedSongs)})});